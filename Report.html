<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Report.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Overview.html">Project Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://dani-quigee-shiny.shinyapps.io/My_first_Shiny/#section-drug-use">Explore the Data</a>
</li>
<li>
  <a href="Analysis.html">Analysis</a>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="Screencast.html">
    <span class="fa fa-video fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/jg-97/p8105_final_project_vaping">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<div id="our-research-questions" class="section level1">
<h1>Our research questions:</h1>
<ul>
<li><p>Whether the distribution of vaping has been similar trends as other drugs? What will the trend look like?</p></li>
<li><p>Is there any association between mental health and vaping in NYC youth?</p></li>
<li><p>What are drugs decomposed by demographics and year?</p></li>
<li><p>Is vaping associated with violenced and other risky behaviors?</p></li>
</ul>
</div>
<div id="explorary-analysis" class="section level1">
<h1>Explorary Analysis</h1>
<pre class="r"><code>### load the cleaned data
load(&quot;./data/nyc_data.RData&quot;)
nyc_drug &lt;- df_total</code></pre>
<div id="vaping-other-drug-use" class="section level2">
<h2>Vaping &amp; other drug use</h2>
<p>Animated graphs show the distributions of vaping and other drug use.</p>
<pre class="r"><code>## filter the data used in this part
nyc_drug_used &lt;- nyc_drug %&gt;% 
  select(id, borough, year, 
         cigarette = current_cigarette_use, cigar = current_cigar_use,
         alcohol = current_alcohol_use, marijuana = current_marijuana_use,
         vaping = current_vaping) %&gt;% 
  mutate(year = factor(year))

## cigarette proportion
cigarette &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(cigarette)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            cigarette = sum(cigarette == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## cigar proportion
cigar &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(cigar)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            cigar = sum(cigar == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 

## alcohol proportion
alcohol &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(alcohol)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            alcohol = sum(alcohol == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 


## vaping proportion 
vaping &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(vaping)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            vaping = sum(vaping == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 

## marijuana proportion with all other proportions
marijuana_full &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(marijuana)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            marijuana = sum(marijuana == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(cigar, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(alcohol, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(vaping, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  pivot_longer(marijuana:vaping,
               names_to = &quot;drug_type&quot;,
               values_to = &quot;proportion&quot;)

drug_p &lt;- marijuana_full %&gt;%
  filter(!(is.na(proportion)))%&gt;%
  ggplot(aes(x = year, y = proportion, color = borough, shape = drug_type, 
             group = interaction(borough, drug_type), frame = drug_type)) +
  geom_point(size = 2.2) + geom_path(size = .8) +
  labs(title = &quot;{closest_state}&quot;,
       x = &quot;Year&quot;,
       y = &quot;Proportion of drug use&quot;,
       color = &quot;Borough&quot;,
       shape = &quot;Drug type&quot;) +
  theme(plot.title = element_text(size = 30, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;)) +  
  transition_states(drug_type, transition_length = 1, state_length = 3, wrap = TRUE) +
  enter_fade() + exit_fade()

animate(drug_p)</code></pre>
<p><img src="Report_files/figure-html/distribution_vaping_other_drugs-1.gif" /><!-- --></p>
<ul>
<li><p>Among five kinds of drugs(vaping), alcohol holds the highest proportion but decreases in use from 2007 across five boroughs in NYC. In addition, cigarette has a lower total proportion than alcohol but the similar decreasing trend after 2009.</p></li>
<li><p>Cigar maintains the steady but low-proportion trend during 2003-2017, which could be compared with marijuana holding steady but higher proportion in total. Moreover, the marijuana users in Manhattan increase from the lowest level to highest level among five boroughs during 2007-2011.</p></li>
<li><p>Vaping, which is our target subject, hold the increasing trend from 2015-2017. This trend is quite similar to the alcohol, cigar and cigarette before being intervented, and maintains at the same proportion level with marijuana in 2015-2017, which indicates that it can grow into a new drug threatening the public health.</p></li>
</ul>
</div>
<div id="mental-health" class="section level2">
<h2>Mental health</h2>
<p>Animated graphs show the distributions of mental health problems which are related to vaping.</p>
<pre class="r"><code>## data for mental health disorder
nyc_drug_health &lt;- nyc_drug %&gt;% 
  select(id, year, borough, sad = sad_hopeless, 
         suicide = attempted_suicide, injury = injurious_suicide_attempt) %&gt;% 
  mutate(year = factor(year))

## sadless
sad &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(sad)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            sad = sum(sad == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## attempted suicide
suicide &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(suicide)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            suicide = sum(suicide == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## injurious attempted suicide
injury_full &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(injury)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            injury = sum(injury == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(sad, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(suicide, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  pivot_longer(injury:suicide,
               names_to = &quot;mental_disorder&quot;,
               values_to = &quot;proportion&quot;)

## animated plot
mental_p &lt;- injury_full %&gt;%
  filter(!(is.na(proportion))) %&gt;% 
  ggplot(aes(x = year, y = proportion, color = borough, shape = mental_disorder, 
             group = interaction(borough, mental_disorder))) +
  geom_point(size = 2.2) + geom_path(size = .8) +
  labs(x = &quot;Year&quot;,
       y = &quot;Proportion of mental disorder&quot;,
       color = &quot;Borough&quot;,
       shape = &quot;Mental disorder&quot;) +  
  scale_shape_discrete(labels = c(&quot;injurious attempted suicide&quot;, &quot;sad and hopeless&quot;, &quot;attempted suicide&quot;)) +
  theme(axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;))  +
  transition_states(mental_disorder, transition_length = 1, state_length = 3, wrap = TRUE) +
  enter_fade() + exit_fade()

animate(mental_p)</code></pre>
<p><img src="Report_files/figure-html/distribution_mental_health-1.gif" /><!-- --></p>
<ul>
<li><p>Above three mental disorders are related to the vaping and other drug use in the report/survey. The emotion issue, feeling sad and hopeless, hold the highest level among three metal disorders. The data shows large number of teenagers do not have a positive mood based on the participants attending the report, and the trend decreases slightly after 2009. Staten Island keeps the lowest proportion in the reported sadness except 2011. Bronx almost keeps the highest level and Queens fluctuates heavily which decreases a lot during 2005 to 2011.</p></li>
<li><p>The proportion of attempted suicide holds the level near 0.1 and is higher than that of getting injured due to the attempted suicide. Both of attempted suicide and injurious attempted suicide keep the relative steady trend in proportion and the same level across five boroughs.</p></li>
</ul>
</div>
<div id="violence-and-other-risky-behaviors" class="section level2">
<h2>Violence and other risky behaviors</h2>
<p>We are interested in whether violence and risky behaviors have difference profiles than other drug use.</p>
<pre class="r"><code>## drugs with violence
nyc_drug_violence &lt;- nyc_drug %&gt;% 
  select(id, borough, year, 
         cigarette = current_cigarette_use, cigar = current_cigar_use,
         alcohol = current_alcohol_use, marijuana = current_marijuana_use,
         vaping = current_vaping, safety_concerns_at_school, threatened_at_school,  
         physical_fighting, bullying_at_school, bullying_electronically,
         texting_and_driving, drinking_and_driving, carring_weapon) %&gt;% 
  mutate(year = factor(year))

## cigaretteYes
cigarette_yes &lt;- nyc_drug_violence %&gt;% 
  filter(cigarette == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigarette = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
 select(-n)

## cigarYes
cigar_yes &lt;- nyc_drug_violence %&gt;% 
  filter(cigar == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigar = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## alcoholYes
alcohol_yes &lt;- nyc_drug_violence %&gt;% 
  filter(alcohol == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            alcohol = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## vapingYes
vaping_yes &lt;- nyc_drug_violence %&gt;% 
  filter(vaping == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            vaping = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## marijuanaYes with all other drugs
marijuana_yes_full &lt;- nyc_drug_violence %&gt;% 
  filter(marijuana == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            marijuana = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(cigar_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(alcohol_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(vaping_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  gather(key = &quot;drug&quot;, value = &quot;proportion&quot;, 
         marijuana, cigarette, cigar, alcohol, vaping)


## animated plot
violence_p &lt;- marijuana_yes_full %&gt;%
  ggplot(aes(x = drug, y = proportion, fill = violence, group = violence)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  labs(title = &quot;Teenagers using drugs in {closest_state}&quot;,
       x = &quot;Drug Type&quot;,
       y = &quot;Proportion of happening violence&quot;,
       fill = &quot;Violence Type&quot;) +
  theme(plot.title = element_text(size = 20, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.position = &quot;none&quot;) +
  transition_states(year, transition_length = 2, state_length = 3) +
  enter_fade() + exit_shrink()

yes_p &lt;- animate(violence_p, fps = 2, width = 480, height = 350)


# Plot under non-use of drug
## cigaretteNo
cigarette_no &lt;- nyc_drug_violence %&gt;% 
  filter(cigarette == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigarette = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
 select(-n)

## cigarNo
cigar_no &lt;- nyc_drug_violence %&gt;% 
  filter(cigar == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigar = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## alcoholNo
alcohol_no &lt;- nyc_drug_violence %&gt;% 
  filter(alcohol == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            alcohol = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## vapingNo
vaping_no &lt;- nyc_drug_violence %&gt;% 
  filter(vaping == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            vaping = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## marijuanaYes with all other drugs
marijuana_no_full &lt;- nyc_drug_violence %&gt;% 
  filter(marijuana == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, texting_and_driving, drinking_and_driving, 
         carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            marijuana = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(cigar_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(alcohol_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(vaping_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  gather(key = &quot;drug&quot;, value = &quot;proportion&quot;, 
         marijuana, cigarette, cigar, alcohol, vaping)


## animated plot
violence_no_p &lt;- marijuana_no_full %&gt;%
  ggplot(aes(x = drug, y = proportion, fill = violence, group = violence)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  labs(title = &quot;Teenagers not using drugs in {closest_state}&quot;,
       x = &quot;Drug Type&quot;,
       y = &quot;Proportion of happening violence&quot;,
       fill = &quot;Violence Type&quot;) +
  scale_fill_discrete(labels = c(&quot;Bullying at school&quot;, &quot;Bullying electronically&quot;,
                                 &quot;Carrying weapons&quot;, &quot;Drinking and driving&quot;,
                                 &quot;Physical fighting&quot;, &quot;Safely concerns at school&quot;,
                                 &quot;Texting and driving&quot;, &quot;Threatened at school&quot;)) +
  theme(plot.title = element_text(size = 20, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;)) +
  transition_states(year, transition_length = 2, state_length = 3) +
  enter_fade() + exit_shrink()

no_p &lt;- animate(violence_no_p, fps = 2, width = 620, height = 350)

combine_gifs &lt;- function(plot1, plot2) {
    require(magick) 
    # read the plots and store them
    plot1 &lt;- image_read(plot1) 
    plot2 &lt;- image_read(plot2) 
    # sync the number of frames in each plot
    n1 = length(plot1)
    n2 = length(plot2)
    # match number of frames of the two plots
    if (!(n1 == n2)) plot1 &lt;- rep(plot1, n2) 
    if (!(n1 == n2)) plot2 &lt;- rep(plot2, n1)
    # initialize the combined plot
    p &lt;- image_append(c(plot1[1], plot2[1]))
    # grow the combined plot frame by frame
    n = ifelse(n1 == n2, n1, n1 * n2) 
    n = min(1000, n)  # set max to 1000
    for (i in 2:(n-1)) {
        tmp &lt;- image_append(c(plot1[i], plot2[i]))
        p &lt;- c(p, tmp)
    }
    return(p) 
}

combine_gifs(plot1 = yes_p, plot2 = no_p)</code></pre>
<p><img src="Report_files/figure-html/drug_with_violence_risky_behaviors-1.gif" /><!-- --></p>
<ul>
<li>The left plot has the twice value than the right plot when the bar is in the same height. Therefore, the proportion of having violence nad risky behaviors in the teenagers who use drugs is nearly twice than the that in the teenagers who are non-drug users. Moreover, non-drug users have lower proportion in carrying weapons from 2003 to 2017.</li>
<li>Driving after drinking, physical fighting, feeling unsafe at school and being treantened at school increase in proportion during 2005-2007, keep the same proportion in 2009, and begin to decrease in 2011.</li>
<li>Physical fighting keeps high proportion in both drug users and non-drug users and becomes a issue which is hard to control and intervent in 2003-2017.</li>
<li>Texting when driving also keeps high level in proportion from 2015 to 2017 and exceeds the proportion of physical fighting in 2017.</li>
<li>Bullying electronically is another issue whose proportion inceases from 2015 to 2017 in both two groups</li>
</ul>
</div>
<div id="prediction-logistic-regression" class="section level2">
<h2>Prediction: Logistic regression</h2>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
