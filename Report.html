<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Report.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Overview.html">Project Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data.html">Data</a>
</li>
<li>
  <a href="https://dani-quigee-shiny.shinyapps.io/My_first_Shiny/#section-drug-use">Explore the Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="EDA.html">EDA</a>
    </li>
    <li>
      <a href="Logistic_Regression_Description.html">Logistic Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="Screencast.html">
    <span class="fa fa-video fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/jg-97/p8105_final_project_vaping">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<p><br></p>
<div id="motivation-related-work" class="section level1">
<h1>Motivation &amp; Related Work</h1>
<p><br></p>
<p><left><img src = "images/youthvaping.jpg" style = "width:60%"> </left></p>
<p><br></p>
<p>Vaping, the inhaling of a vapor created by vaping devices like e-cigarettes, was initially regarded as a less harmful substitution for cigarettes. However, vaping still introduces nicotine into the body. The prevalence of lung damage caused by vaping is actually so high that the CDC[<a href="https://www.sciencedirect.com/science/article/pii/S2213260019304096?via=ihub">1</a>] needed to issue guidance explicitly on it. According to the New York Post, a second vaping related death occured on November 9th, 2019. Vaping has claimed at least 42 lives and injured over 2,000 others across the country[<a href="https://nypost.com/2019/11/20/second-new-yorker-dead-from-vaping-related-illness-officials/">2</a>].</p>
<p>As the popularity of vaping grows, concerns about vaping are covered both in academia and in the press[<a href="https://health.usnews.com/health-care/for-better/articles/2018-06-13/how-teenage-vaping-puts-structure-in-place-for-heroin-and-cocaine-addiction">3</a>,<a href="https://www.cnn.com/2015/09/04/us/vaping-abuse/index.html">4</a>]. A journal article published recently even describes the prevalence of vaping in a “red alert” state[<a href="https://link.springer.com/article/10.1057/s41271-019-00193-2">5</a>]. In press, vaping is accused of being both a gateway drug and a new “drug” itself. 81% Americans report teenagers who would not smoke cigarettes are using flavored e-cigarettes[<a href="https://www.kff.org/other/issue-brief/data-note-vaping-and-e-cigarettes/">6</a>]. To provide grounds for potential public health interventions on this “scourge of drug”[<a href="https://www.cnn.com/2015/09/04/us/vaping-abuse/index.html">6</a>], we will evaluate the current landscape of vaping usage among teenagers and young adults in NYC using pre-collected data and analyze the potential risks of vaping in terms of future substance abuse and mental hygiene condistions.</p>
<p><br></p>
<p><strong>Facts about vaping</strong></p>
<ul>
<li><p>2,051 reported lung illness cases and 39 lung illness deaths due to vaping.[<a href="https://www.engadget.com/2019/11/07/cdc-confirms-vaping-lung-injury/">1</a>]</p></li>
<li><p>81% Americans report teenagers who would not smoke cigarettes are using flavored e-cigarettes.[<a href="https://www.kff.org/other/issue-brief/data-note-vaping-and-e-cigarettes/">2</a>]</p></li>
<li><p>Most popular e-cigarette product introduces with a 5% nicotine up to 2.7 times delievering nicotine than others.[<a href="https://truthinitiative.org/research-resources/emerging-tobacco-products/how-much-nicotine-juul">3</a>]</p></li>
</ul>
<p>According to reports in recent years, we can see an underlying trend of vaping is increasing, especially in the teenager group.</p>
<p><br> <br></p>
</div>
<div id="initial-questions" class="section level1">
<h1>Initial Questions</h1>
<p><br></p>
<ol style="list-style-type: decimal">
<li><p>How did drugs use change over time in NYC’s youth?</p></li>
<li><p>How did mental health related issues change over time in NYC’s youth?</p></li>
<li><p>How does drug use and mental health status differ by demographics in NYC’s youth?</p></li>
<li><p>How do risky and violent behaviors differ between NYC children using drugs and not using drugs?</p></li>
<li><p>Can we build a model with current available data to predict future vaping use?</p></li>
</ol>
<p>Initially, we were interested in building a model to determine associations. However, as our studies in data science class progressed further, we learned new great procedures and methods that we wanted to incorporate into our project. In particular, we became interested in building a predictive model based on data from 2015, and using this data to predict vaping for 2017</p>
<p><br> <br></p>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p><br></p>
<p>We utilized the <strong>YRBSS</strong> dataset publicly available on <a href="https://www.cdc.gov/healthyyouth/data/yrbs/data.htm">CDC.gov</a>. The YRBSS started in 1990 with the goal to monitor health behaviors that contribute markedly to the leading causes of death, disability, and social issues among youth and adults in the United States. The YRBSS monitors behaviors surrouning, for example,</p>
<ul>
<li>Alcohol and other drug use</li>
<li>Tabacco use</li>
<li>Unhealthy dietry behaviors</li>
<li>Physical activity</li>
<li>Sexuality and birth control</li>
</ul>
<p>Between 1991 and 2017, the YRBSS has gathered data from more than 4.4 million high school students in more than 1900 separate surveys.</p>
<p>Since the dataset is quite extensive - it contains national, state, and district wide data - we decided to focus on data from New York City and investigate youth behaviors related to drug use.</p>
<p>In particular, we downloaded the <a href="https://www.cdc.gov/healthyyouth/data/yrbs/data.htm">Districts(zip)</a> data in the Access file format. Subsequently, we used <strong>Microsoft Access 2019</strong>, to extract the data pertaining to the five boroughs of NYC. Since <strong>Microsoft Access 2019</strong> only allowed for a maximum of 65000 observations to be exported as an Excel document at once, we ended up with five Excel documents - one for each borough. These datasets can be found <a href="https://github.com/jg-97/p8105_final_project_vaping/tree/master/raw_data">here</a>. Finally, we used R to combine these five datasets and to select variables of interest to us. These variables provided insights into drug usage behaviors, included risky and violent behaviors, and pertained towards mental health, and demographics. While picking suitable variables, we also took into account the response rates (how many missing values are present in a certain variable in a particular year).</p>
<p>In the end, we worked with the following variables:</p>
<p><strong>Demographics</strong></p>
<ul>
<li><em>borough</em>: one of the five boroughs of NYC</li>
<li><em>year</em>: year of the survey</li>
<li><em>age</em>: age of the subject</li>
<li><em>sex</em>: gender of the subject (male, female)</li>
<li><em>race7</em>: race of the subject</li>
</ul>
<p><strong>Drug Use</strong></p>
<ul>
<li><em>current_cigarette_use</em>: smoked cigarettes during the past 30 days (Yes/No)</li>
<li><em>current_vaping</em>: used an electronic vapor product during the past 30 days (Yes/No)</li>
<li><em>current_cigar_use</em>: smoked cigars, cigarillos, or little cigars during the past 30 days (Yes/No)</li>
<li><em>current_alcohol_use</em>: had at least one drink of alcohol during the past 30 days (Yes/No)</li>
<li><em>current_marijuana_use</em>: used marijuana during the past 30 days (Yes/No)</li>
</ul>
<p><strong>Mental Health</strong></p>
<ul>
<li><em>sad_hopeless</em>: during the past 12 months, felt so sad or hopeless almost every day for two weeks or more in a row that doing some usual activities was impossible (Yes/No)</li>
<li><em>attempted_suicide</em>: during the past 12 months, actually attempt suicide (Yes/No)</li>
<li><em>injurious_suicide_attempt</em>: attempted suicide, during the past 12 months, resulted in an injury, poisoning, or overdose that had to be treated by a doctor or nurse (Yes/No)</li>
<li><em>considered_suicide</em>: during the past 12 months, seriously considered attempting suicide (Yes/No)</li>
</ul>
<p><strong>Risky Behaviors/Violence</strong></p>
<ul>
<li><em>safety_concerns_at_school</em>: subject did not went to school due to feeling unsafe at school or on way to or from school during the past 30 days (Yes/No)</li>
<li><em>threatened_at_school</em>: subject has been threatened or injured with a weapon such as a gun, knife, or club on school property during the past 12 months (Yes/No)</li>
<li><em>physical_fighting</em>: subject has been in a physical fight during the past 12 months (Yes/No)</li>
<li><em>bullying_at_school</em>: subject has been bullied on school property during the past 12 months (Yes/No)</li>
<li><em>bullying_electronically</em>: subject has been bullied electronically (i.e. facebook) during the past 12 months (Yes/No)</li>
<li><em>illegal_injected_drug_use</em>: subject has used needle to inject any illegal drug into body during life time (Yes/No)</li>
<li><em>carring_weapon</em>: subject carried a weapon such as a gun, knife, or club during the past 30 days (Yes/No)</li>
<li><em>sex_before_13</em>: subject had first sexual intercourse before age 13 (Yes/No)</li>
<li><em>current_sexual_activity</em>: subject had sexual intercourse with 1 or more people during the past 3 months (Yes/No)</li>
</ul>
<p><br> <br></p>
</div>
<div id="explorary-analysis" class="section level1">
<h1>Explorary Analysis</h1>
<p><br></p>
<pre class="r"><code>### load the cleaned data
load(&quot;./data/nyc_data.RData&quot;)
nyc_drug &lt;- df_total</code></pre>
<div id="vaping-other-drug-use" class="section level2">
<h2>Vaping &amp; other drug use</h2>
<p>Animated graphs show the distributions of vaping and other drug use.</p>
<pre class="r"><code>## filter the data used in this part
nyc_drug_used &lt;- nyc_drug %&gt;% 
  select(id, borough, year, 
         cigarette = current_cigarette_use, cigar = current_cigar_use,
         alcohol = current_alcohol_use, marijuana = current_marijuana_use,
         vaping = current_vaping) %&gt;% 
  mutate(year = factor(year))

## cigarette proportion
cigarette &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(cigarette)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            cigarette = sum(cigarette == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## cigar proportion
cigar &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(cigar)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            cigar = sum(cigar == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 

## alcohol proportion
alcohol &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(alcohol)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            alcohol = sum(alcohol == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 


## vaping proportion 
vaping &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(vaping)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            vaping = sum(vaping == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) 

## marijuana proportion with all other proportions
marijuana_full &lt;- nyc_drug_used %&gt;% 
  filter(!is.na(marijuana)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            marijuana = sum(marijuana == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(cigar, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(alcohol, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(vaping, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  pivot_longer(marijuana:vaping,
               names_to = &quot;drug_type&quot;,
               values_to = &quot;proportion&quot;)

drug_p &lt;- marijuana_full %&gt;%
  filter(!(is.na(proportion)))%&gt;%
  ggplot(aes(x = year, y = proportion, color = borough, shape = drug_type, 
             group = interaction(borough, drug_type), frame = drug_type)) +
  geom_point(size = 2.2) + geom_path(size = .8) +
  labs(title = &quot;{closest_state}&quot;,
       x = &quot;Year&quot;,
       y = &quot;Proportion of drug use&quot;,
       color = &quot;Borough&quot;,
       shape = &quot;Drug type&quot;) +
  theme(plot.title = element_text(size = 30, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;)) +  
  transition_states(drug_type, transition_length = 1, state_length = 3, wrap = TRUE) +
  enter_fade() + exit_fade()

animate(drug_p)</code></pre>
<p><img src="Report_files/figure-html/distribution_vaping_other_drugs-1.gif" /><!-- --></p>
<ul>
<li><p>Among five kinds of drugs(vaping), alcohol holds the highest proportion but decreases in use from 2007 across five boroughs in NYC. In addition, cigarette has a lower total proportion than alcohol but the similar decreasing trend after 2009.</p></li>
<li><p>Cigar maintains the steady but low-proportion trend during 2003-2017, which could be compared with marijuana holding steady but higher proportion in total. Moreover, the marijuana users in Manhattan increase from the lowest level to highest level among five boroughs during 2007-2011.</p></li>
<li><p>Vaping, which is our target subject, hold the increasing trend from 2015-2017. This trend is quite similar to the alcohol, cigar and cigarette before being intervented, and maintains at the same proportion level with marijuana in 2015-2017, which indicates that it can grow into a new drug threatening the public health.</p></li>
</ul>
</div>
<div id="mental-health" class="section level2">
<h2>Mental health</h2>
<p>Animated graphs show the distributions of mental health problems which are related to vaping.</p>
<pre class="r"><code>## data for mental health disorder
nyc_drug_health &lt;- nyc_drug %&gt;% 
  select(id, year, borough, sad = sad_hopeless, 
         suicide = attempted_suicide, injury = injurious_suicide_attempt) %&gt;% 
  mutate(year = factor(year))

## sadless
sad &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(sad)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            sad = sum(sad == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## attempted suicide
suicide &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(suicide)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            suicide = sum(suicide == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## injurious attempted suicide
injury_full &lt;- nyc_drug_health %&gt;% 
  filter(!is.na(injury)) %&gt;% 
  group_by(year, borough) %&gt;% 
  summarize(n = n(),
            injury = sum(injury == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(sad, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  left_join(suicide, by = c(&quot;year&quot;, &quot;borough&quot;)) %&gt;% 
  pivot_longer(injury:suicide,
               names_to = &quot;mental_disorder&quot;,
               values_to = &quot;proportion&quot;)

## animated plot
mental_p &lt;- injury_full %&gt;%
  filter(!(is.na(proportion))) %&gt;% 
  ggplot(aes(x = year, y = proportion, color = borough, shape = mental_disorder, 
             group = interaction(borough, mental_disorder))) +
  geom_point(size = 2.2) + geom_path(size = .8) +
  labs(x = &quot;Year&quot;,
       y = &quot;Proportion of mental disorder&quot;,
       color = &quot;Borough&quot;,
       shape = &quot;Mental disorder&quot;) +  
  scale_shape_discrete(labels = c(&quot;injurious attempted suicide&quot;, &quot;sad and hopeless&quot;, &quot;attempted suicide&quot;)) +
  theme(axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;))  +
  transition_states(mental_disorder, transition_length = 1, state_length = 3, wrap = TRUE) +
  enter_fade() + exit_fade()

animate(mental_p)</code></pre>
<p><img src="Report_files/figure-html/distribution_mental_health-1.gif" /><!-- --></p>
<ul>
<li><p>Above three mental disorders are related to the vaping and other drug use in the report/survey. The emotion issue, feeling sad and hopeless, hold the highest level among three metal disorders. The data shows large number of teenagers do not have a positive mood based on the participants attending the report, and the trend decreases slightly after 2009. Staten Island keeps the lowest proportion in the reported sadness except 2011. Bronx almost keeps the highest level and Queens fluctuates heavily which decreases a lot during 2005 to 2011.</p></li>
<li><p>The proportion of attempted suicide holds the level near 0.1 and is higher than that of getting injured due to the attempted suicide. Both of attempted suicide and injurious attempted suicide keep the relative steady trend in proportion and the same level across five boroughs.</p></li>
</ul>
</div>
<div id="violence-and-other-risky-behaviors" class="section level2">
<h2>Violence and other risky behaviors</h2>
<p>We are interested in whether violence and risky behaviors have difference profiles than other drug use.</p>
<pre class="r"><code>## drugs with violence
nyc_drug_violence &lt;- nyc_drug %&gt;% 
  select(id, borough, year, 
         cigarette = current_cigarette_use, cigar = current_cigar_use,
         alcohol = current_alcohol_use, marijuana = current_marijuana_use,
         vaping = current_vaping, safety_concerns_at_school, threatened_at_school,  
         physical_fighting, bullying_at_school, bullying_electronically, 
         carring_weapon) %&gt;% 
  mutate(year = factor(year))

## cigaretteYes
cigarette_yes &lt;- nyc_drug_violence %&gt;% 
  filter(cigarette == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigarette = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
 select(-n)

## cigarYes
cigar_yes &lt;- nyc_drug_violence %&gt;% 
  filter(cigar == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigar = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## alcoholYes
alcohol_yes &lt;- nyc_drug_violence %&gt;% 
  filter(alcohol == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            alcohol = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## vapingYes
vaping_yes &lt;- nyc_drug_violence %&gt;% 
  filter(vaping == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            vaping = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## marijuanaYes with all other drugs
marijuana_yes_full &lt;- nyc_drug_violence %&gt;% 
  filter(marijuana == &quot;Yes&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            marijuana = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(cigar_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(alcohol_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(vaping_yes, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  gather(key = &quot;drug&quot;, value = &quot;proportion&quot;, 
         marijuana, cigarette, cigar, alcohol, vaping)


## animated plot
violence_p &lt;- marijuana_yes_full %&gt;%
  ggplot(aes(x = drug, y = proportion, fill = violence, group = violence)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  labs(title = &quot;Teenagers using drugs in {closest_state}&quot;,
       x = &quot;Drug Type&quot;,
       y = &quot;Proportion of happening violence&quot;,
       fill = &quot;Violence Type&quot;) +
  theme(plot.title = element_text(size = 20, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.position = &quot;none&quot;) +
  transition_states(year, transition_length = 2, state_length = 3) +
  enter_fade() + exit_shrink()

yes_p &lt;- animate(violence_p, fps = 2, width = 480, height = 350)


# Plot under non-use of drug
## cigaretteNo
cigarette_no &lt;- nyc_drug_violence %&gt;% 
  filter(cigarette == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigarette = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
 select(-n)

## cigarNo
cigar_no &lt;- nyc_drug_violence %&gt;% 
  filter(cigar == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            cigar = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## alcoholNo
alcohol_no &lt;- nyc_drug_violence %&gt;% 
  filter(alcohol == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            alcohol = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## vapingNo
vaping_no &lt;- nyc_drug_violence %&gt;% 
  filter(vaping == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            vaping = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n)

## marijuanaYes with all other drugs
marijuana_no_full &lt;- nyc_drug_violence %&gt;% 
  filter(marijuana == &quot;No&quot;) %&gt;% 
  gather(key = &quot;violence&quot;, value = &quot;reply&quot;, safety_concerns_at_school, 
         threatened_at_school, physical_fighting, bullying_at_school, 
         bullying_electronically, carring_weapon, na.rm = TRUE) %&gt;% 
  group_by(year, violence) %&gt;% 
  summarize(n = n(),
            marijuana = sum(reply == &quot;Yes&quot;)/n) %&gt;% 
  select(-n) %&gt;% 
  left_join(cigarette_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(cigar_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(alcohol_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  left_join(vaping_no, by = c(&quot;year&quot;, &quot;violence&quot;)) %&gt;% 
  gather(key = &quot;drug&quot;, value = &quot;proportion&quot;, 
         marijuana, cigarette, cigar, alcohol, vaping)


## animated plot
violence_no_p &lt;- marijuana_no_full %&gt;%
  ggplot(aes(x = drug, y = proportion, fill = violence, group = violence)) +
  geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  labs(title = &quot;Teenagers not using drugs in {closest_state}&quot;,
       x = &quot;Drug Type&quot;,
       y = &quot;Proportion of happening violence&quot;,
       fill = &quot;Violence Type&quot;) +
  scale_fill_discrete(labels = c(&quot;Bullying at school&quot;, &quot;Bullying electronically&quot;,
                                 &quot;Carrying weapons&quot;,&quot;Physical fighting&quot;, 
                                 &quot;Safely concerns at school&quot;, &quot;Threatened at school&quot;)) +
  theme(plot.title = element_text(size = 20, face = &quot;bold&quot;),
        axis.text = element_text(size = 15),
        axis.title = element_text(size = 15,face = &quot;bold&quot;)) + 
  theme(legend.text = element_text(size = 10), legend.title = element_text(size = 15, face = &quot;bold&quot;)) +
  transition_states(year, transition_length = 2, state_length = 3) +
  enter_fade() + exit_shrink()

no_p &lt;- animate(violence_no_p, fps = 2, width = 620, height = 350)

combine_gifs &lt;- function(plot1, plot2) {
    require(magick) 
    # read the plots and store them
    plot1 &lt;- image_read(plot1) 
    plot2 &lt;- image_read(plot2) 
    # sync the number of frames in each plot
    n1 = length(plot1)
    n2 = length(plot2)
    # match number of frames of the two plots
    if (!(n1 == n2)) plot1 &lt;- rep(plot1, n2) 
    if (!(n1 == n2)) plot2 &lt;- rep(plot2, n1)
    # initialize the combined plot
    p &lt;- image_append(c(plot1[1], plot2[1]))
    # grow the combined plot frame by frame
    n = ifelse(n1 == n2, n1, n1 * n2) 
    n = min(1000, n)  # set max to 1000
    for (i in 2:(n-1)) {
        tmp &lt;- image_append(c(plot1[i], plot2[i]))
        p &lt;- c(p, tmp)
    }
    return(p) 
}

combine_gifs(plot1 = yes_p, plot2 = no_p)</code></pre>
<p><img src="Report_files/figure-html/drug_with_violence_risky_behaviors-1.gif" /><!-- --></p>
<ul>
<li><p>The left plot has the twice value than the right plot when the bar is in the same height. Therefore, the proportion of having violence nad risky behaviors in the teenagers who use drugs is nearly twice than the that in the teenagers who are non-drug users. Moreover, non-drug users have lower proportion in carrying weapons from 2003 to 2017.</p></li>
<li><p>Physical fighting, feeling unsafe at school and being treantened at school increase in proportion during 2005-2007, keep the same proportion in 2009, and begin to decrease in 2011.</p></li>
<li><p>Physical fighting keeps high proportion in both drug users and non-drug users and becomes a issue which is hard to control and intervent in 2003-2017.</p></li>
<li><p>Bullying electronically is another issue whose proportion inceases from 2015 to 2017 in both two groups</p></li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="logistic-regression-model" class="section level1">
<h1>Logistic Regression Model</h1>
<p><br></p>
<p>Since we were investigating the prevelance and trend in vaping among NYC’s youth, we were interested in predicting <strong>current_vaping</strong>. We began our model building process considering the following predictors:</p>
<p><strong>Demographics</strong></p>
<ul>
<li><em>borough</em>: one of the five boroughs of NYC</li>
<li><em>age</em>: age of the subject</li>
<li><em>sex</em>: gender of the subject (male, female)</li>
<li><em>race7</em>: race of the subject</li>
</ul>
<p><strong>Mental Health</strong></p>
<ul>
<li><em>sad_hopeless</em>: during the past 12 months, felt so sad or hopeless almost every day for two weeks or more in a row that doing some usual activities was impossible (Yes/No)</li>
<li><em>attempted_suicide</em>: during the past 12 months, actually attempt suicide (Yes/No)</li>
<li><em>injurious_suicide_attempt</em>: attempted suicide, during the past 12 months, resulted in an injury, poisoning, or overdose that had to be treated by a doctor or nurse (Yes/No)</li>
<li><em>considered_suicide</em>: during the past 12 months, seriously considered attempting suicide (Yes/No)</li>
</ul>
<p><strong>Risky Behaviors/Violence</strong></p>
<ul>
<li><em>safety_concerns_at_school</em>: subject did not went to school due to feeling unsafe at school or on way to or from school during the past 30 days (Yes/No)</li>
<li><em>threatened_at_school</em>: subject has been threatened or injured with a weapon such as a gun, knife, or club on school property during the past 12 months (Yes/No)</li>
<li><em>physical_fighting</em>: subject has been in a physical fight during the past 12 months (Yes/No)</li>
<li><em>bullying_at_school</em>: subject has been bullied on school property during the past 12 months (Yes/No)</li>
<li><em>bullying_electronically</em>: subject has been bullied electronically (i.e. facebook) during the past 12 months (Yes/No)</li>
<li><em>illegal_injected_drug_use</em>: subject has used needle to inject any illegal drug into body during life time (Yes/No)</li>
<li><em>carring_weapon</em>: subject carried a weapon such as a gun, knife, or club during the past 30 days (Yes/No)</li>
<li><em>sex_before_13</em>: subject had first sexual intercourse before age 13 (Yes/No)</li>
<li><em>current_sexual_activity</em>: subject had sexual intercourse with 1 or more people during the past 3 months (Yes/No)</li>
</ul>
<p><br> <br></p>
<div id="manuel-method" class="section level2">
<h2>Manuel Method</h2>
<p><br></p>
<p>First, we attempted to find a predictive model by using a variation on <strong>stepwise/automatic procedures</strong> (by hand). We utilized p-values and prediction accuracy as our guidance for which predictors to choose, starting with the full model. In the end, this process came up with the following possible model:</p>
<p><br></p>
<p><strong>Model 1</strong></p>
<p>current_vaping ~ sad_hopeless + attempted_suicide + safety_concerns_at_school + illegal_injected_drug_use + physical_fighting + bullying_electronically + carring_weapon + sex_before_13</p>
<p><br> <br></p>
</div>
<div id="hao-method" class="section level2">
<h2>Hao Method</h2>
<p><br></p>
</div>
<div id="siquan-method" class="section level2">
<h2>Siquan Method</h2>
<p><br></p>
</div>
<div id="model-selection" class="section level2">
<h2>Model Selection</h2>
</div>
</div>
<div id="discussion" class="section level1">
<h1>Discussion</h1>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
