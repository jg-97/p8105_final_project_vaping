<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>logistic_reg_siquan.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Overview.html">Project Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://dani-quigee-shiny.shinyapps.io/My_first_Shiny/#section-drug-use">Explore the Data</a>
</li>
<li>
  <a href="Analysis.html">Analysis</a>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="Screencast.html">
    <span class="fa fa-video fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/jg-97/p8105_final_project_vaping">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="logistic_reg_siquan" class="section level1">
<h1>logistic_reg_Siquan</h1>
<p>Siquan 12/2/2019</p>
<pre class="r"><code># Loading the cleaned data
load(&quot;./data/nyc_data.RData&quot;)</code></pre>
<p>#I decide to use LASSO to automatically help me choose the important covariates in the logistic regression model based on cross-validation error</p>
<pre class="r"><code># Extracting necessary variables (in the following analysis, we only focus on the variables extracted by Daniela in the original&#39;Logistics Regressin.Rmd&#39;)
df = df_total %&gt;% 
  filter(year == 2017| year ==2015) %&gt;% # Basing model on data from both 2015 and 2017
  select(
    year,
    # binary respone
    current_vaping,
    # possible predictor
    texting_and_driving,
    carring_weapon,
    sad_hopeless,
    attempted_suicide,
    injurious_suicide_attempt,
    safety_concerns_at_school,
    threatened_at_school,
    physical_fighting,
    bullying_at_school,
    bullying_electronically,
    sex,
    age,
    race7,
    borough)

summary(df)</code></pre>
<pre><code>##       year      current_vaping       texting_and_driving carring_weapon
##  Min.   :2015   Yes : 2997     Yes             :  935    Yes : 1441    
##  1st Qu.:2015   No  :14707     No/did not drive: 3114    No  :16482    
##  Median :2017   NA&#39;s: 1009     NA&#39;s            :14664    NA&#39;s:  790    
##  Mean   :2016                                                          
##  3rd Qu.:2017                                                          
##  Max.   :2017                                                          
##                                                                        
##  sad_hopeless attempted_suicide              injurious_suicide_attempt
##  Yes : 5547   Yes : 1496        Yes                       :  516      
##  No  :12316   No  :13678        No/did not attempt suicide:14343      
##  NA&#39;s:  850   NA&#39;s: 3539        NA&#39;s                      : 3854      
##                                                                       
##                                                                       
##                                                                       
##                                                                       
##  safety_concerns_at_school threatened_at_school physical_fighting
##  Yes : 1384                Yes : 1239           Yes : 4268       
##  No  :16824                No  :17128           No  :14030       
##  NA&#39;s:  505                NA&#39;s:  346           NA&#39;s:  415       
##                                                                  
##                                                                  
##                                                                  
##                                                                  
##  bullying_at_school bullying_electronically     sex      
##  Yes : 2716         Yes : 2341              female:9496  
##  No  :15490         No  :15921              male  :9032  
##  NA&#39;s:  507         NA&#39;s:  451              NA&#39;s  : 185  
##                                                          
##                                                          
##                                                          
##                                                          
##                     age                                 race7     
##  15 years old         :4776   Hispanic/Latino              :7990  
##  16 years old         :4360   Black or African American    :4184  
##  17 years old         :4092   White                        :2289  
##  14 years old         :3852   Asian                        :2159  
##  18 years old or older: 971   Multiple Races (Non-Hispanic): 582  
##  (Other)              : 573   (Other)                      : 506  
##  NA&#39;s                 :  89   NA&#39;s                         :1003  
##           borough    
##  Bronx        :3952  
##  Brooklyn     :5227  
##  Manhattan    :3857  
##  Queens       :3147  
##  Staten Island:2530  
##                      
## </code></pre>
<pre class="r"><code>str(df)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    18713 obs. of  16 variables:
##  $ year                     : num  2015 2015 2015 2015 2015 ...
##  $ current_vaping           : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA 2 2 NA 2 2 2 2 2 1 ...
##  $ texting_and_driving      : Factor w/ 2 levels &quot;Yes&quot;,&quot;No/did not drive&quot;: NA NA NA NA 2 NA NA 2 NA 1 ...
##  $ carring_weapon           : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA NA 2 2 1 2 2 2 2 NA ...
##  $ sad_hopeless             : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA 1 2 2 NA 2 1 1 1 NA ...
##  $ attempted_suicide        : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA 1 2 2 NA 2 NA 2 2 1 ...
##  $ injurious_suicide_attempt: Factor w/ 2 levels &quot;Yes&quot;,&quot;No/did not attempt suicide&quot;: NA 2 2 2 NA 2 NA 2 2 2 ...
##  $ safety_concerns_at_school: Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 1 2 2 1 2 2 2 2 1 ...
##  $ threatened_at_school     : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA NA 2 2 1 2 2 2 2 1 ...
##  $ physical_fighting        : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: NA NA 2 2 1 2 1 1 2 1 ...
##  $ bullying_at_school       : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 2 2 2 1 1 2 2 1 2 1 ...
##  $ bullying_electronically  : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 2 2 2 2 NA 2 1 2 2 NA ...
##  $ sex                      : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: NA NA NA NA NA NA NA NA NA NA ...
##  $ age                      : Factor w/ 7 levels &quot;12 years old or younger&quot;,..: NA NA NA NA 1 3 3 3 4 5 ...
##  $ race7                    : Factor w/ 7 levels &quot;American Indian/Alaska Native&quot;,..: 4 NA NA 4 NA 3 7 NA 3 NA ...
##  $ borough                  : Factor w/ 5 levels &quot;Bronx&quot;,&quot;Brooklyn&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>#Remove all observations with any missing value
df&lt;-na.omit(df)
#Split data into training and test data set
sample_size = floor(0.8*nrow(df))
set.seed(8105)
picked = sample(seq_len(nrow(df)),size = sample_size)
data_tr =df[picked,]
data_te =df[-picked,]
x_tr &lt;- data_tr[,c(1,3:16)]
y_tr &lt;- data_tr[,2]
x_te &lt;- data_te[,c(1,3:16)]
y_te &lt;- data_te[,2]
#use LASSO since we have so many predictors and automatically let R help us select the important variables
colnames(data_tr)</code></pre>
<pre><code>##  [1] &quot;year&quot;                      &quot;current_vaping&quot;           
##  [3] &quot;texting_and_driving&quot;       &quot;carring_weapon&quot;           
##  [5] &quot;sad_hopeless&quot;              &quot;attempted_suicide&quot;        
##  [7] &quot;injurious_suicide_attempt&quot; &quot;safety_concerns_at_school&quot;
##  [9] &quot;threatened_at_school&quot;      &quot;physical_fighting&quot;        
## [11] &quot;bullying_at_school&quot;        &quot;bullying_electronically&quot;  
## [13] &quot;sex&quot;                       &quot;age&quot;                      
## [15] &quot;race7&quot;                     &quot;borough&quot;</code></pre>
<pre class="r"><code>library(glmnet)
library(gmodels)
#create train set input
Training_x &lt;-  model.matrix( ~ year + carring_weapon +texting_and_driving +carring_weapon+sad_hopeless+attempted_suicide+injurious_suicide_attempt+ safety_concerns_at_school+threatened_at_school+physical_fighting+bullying_at_school+bullying_electronically+sex+age+race7+borough -1, data_tr)
#Use LASSO to do auto variable selection accoridng to cross-validation error
cv.lasso &lt;- cv.glmnet(Training_x, as.matrix(as.numeric(unlist(y_tr))-1), alpha = 1, family = &quot;binomial&quot;)
model_lasso &lt;- glmnet(Training_x, as.matrix(as.numeric(unlist(y_tr))-1), alpha = 1, family = &quot;binomial&quot;,lambda = cv.lasso$lambda.min)
coef(model_lasso)</code></pre>
<pre><code>## 30 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                                s0
## (Intercept)                                         -1.625174e+02
## year                                                 7.982888e-02
## carring_weaponYes                                   -5.041743e-01
## carring_weaponNo                                     9.114951e-15
## texting_and_drivingNo/did not drive                  7.694352e-01
## sad_hopelessNo                                       2.967696e-01
## attempted_suicideNo                                  6.810848e-01
## injurious_suicide_attemptNo/did not attempt suicide  .           
## safety_concerns_at_schoolNo                          3.235722e-01
## threatened_at_schoolNo                               7.252697e-02
## physical_fightingNo                                  8.646754e-01
## bullying_at_schoolNo                                 .           
## bullying_electronicallyNo                            3.467696e-01
## sexmale                                              .           
## age13 years old                                      .           
## age14 years old                                      4.971420e-01
## age15 years old                                      .           
## age16 years old                                      .           
## age17 years old                                      .           
## age18 years old or older                             9.396247e-02
## race7Asian                                           .           
## race7Black or African American                       7.866188e-01
## race7Hispanic/Latino                                 .           
## race7Multiple Races (Non-Hispanic)                   .           
## race7Native Hawaiian/Other Pacific Islander          .           
## race7White                                          -6.065113e-01
## boroughBrooklyn                                     -7.535410e-03
## boroughManhattan                                     7.095502e-02
## boroughQueens                                        .           
## boroughStaten Island                                 .</code></pre>
<pre class="r"><code>#Training set prediction accuracy
model_lasso_train&lt;- round(predict(model_lasso, Training_x, type = &quot;response&quot;))
CrossTable(x = as.numeric(unlist(y_tr))-1,y = model_lasso_train, prop.r = F, prop.c = F, prop.chisq = F)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  1787 
## 
##  
##                              | model_lasso_train 
## as.numeric(unlist(y_tr)) - 1 |         0 |         1 | Row Total | 
## -----------------------------|-----------|-----------|-----------|
##                            0 |       135 |       329 |       464 | 
##                              |     0.076 |     0.184 |           | 
## -----------------------------|-----------|-----------|-----------|
##                            1 |        47 |      1276 |      1323 | 
##                              |     0.026 |     0.714 |           | 
## -----------------------------|-----------|-----------|-----------|
##                 Column Total |       182 |      1605 |      1787 | 
## -----------------------------|-----------|-----------|-----------|
## 
## </code></pre>
<pre class="r"><code>mean(as.numeric(unlist(y_tr))-1 ==model_lasso_train)</code></pre>
<pre><code>## [1] 0.7895915</code></pre>
<pre class="r"><code>#Test set prediction accuracy
Testing_x &lt;-  model.matrix( ~ year + carring_weapon +texting_and_driving +carring_weapon+sad_hopeless+attempted_suicide+injurious_suicide_attempt+ safety_concerns_at_school+threatened_at_school+physical_fighting+bullying_at_school+bullying_electronically+sex+age+race7+borough -1, data_te)

model_lasso_test&lt;- round(predict(model_lasso, Testing_x, type = &quot;response&quot;))
CrossTable(x = as.numeric(unlist(y_te))-1,y = model_lasso_test, prop.r = F, prop.c = F, prop.chisq = F)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  447 
## 
##  
##                              | model_lasso_test 
## as.numeric(unlist(y_te)) - 1 |         0 |         1 | Row Total | 
## -----------------------------|-----------|-----------|-----------|
##                            0 |        29 |        77 |       106 | 
##                              |     0.065 |     0.172 |           | 
## -----------------------------|-----------|-----------|-----------|
##                            1 |        22 |       319 |       341 | 
##                              |     0.049 |     0.714 |           | 
## -----------------------------|-----------|-----------|-----------|
##                 Column Total |        51 |       396 |       447 | 
## -----------------------------|-----------|-----------|-----------|
## 
## </code></pre>
<pre class="r"><code>mean(as.numeric(unlist(y_te))-1 ==model_lasso_test)</code></pre>
<pre><code>## [1] 0.7785235</code></pre>
<pre class="r"><code>#Use prediction accuracy as the evaluation matrix in binary classification task, train set prediction accuracy  0.7879127 and test set prediction accuracy 0.7785235. Since the training set and test set accuracy are pretty close, there is no overfitting.</code></pre>
<p>#Note that we could do the same procedure with the imputed data and see whether the prediction accuracy has been imporved.</p>
<p>#Also note that we could add more potential covariates into the model and see whether the prediction accuracy has been imporved.</p>
<p>#Compare with the original model</p>
<pre class="r"><code>fit_logistic = glm(current_vaping ~ sad_hopeless + attempted_suicide  + safety_concerns_at_school + threatened_at_school + physical_fighting + bullying_electronically + carring_weapon, data = data_tr, family = binomial())

fit_logistics_predict = round(predict(fit_logistic, data_te, type = &quot;response&quot;))
CrossTable(x = as.numeric(unlist(y_te))-1,y = fit_logistics_predict, prop.r = F, prop.c = F, prop.chisq = F)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  447 
## 
##  
##                              | fit_logistics_predict 
## as.numeric(unlist(y_te)) - 1 |         0 |         1 | Row Total | 
## -----------------------------|-----------|-----------|-----------|
##                            0 |        20 |        86 |       106 | 
##                              |     0.045 |     0.192 |           | 
## -----------------------------|-----------|-----------|-----------|
##                            1 |        17 |       324 |       341 | 
##                              |     0.038 |     0.725 |           | 
## -----------------------------|-----------|-----------|-----------|
##                 Column Total |        37 |       410 |       447 | 
## -----------------------------|-----------|-----------|-----------|
## 
## </code></pre>
<pre class="r"><code>mean(as.numeric(unlist(y_te))-1 ==fit_logistics_predict)</code></pre>
<pre><code>## [1] 0.7695749</code></pre>
<p>The original model has a test prediction accuracy of 0.7695749, which is a little bit lower than the LASSO model, but I think both of these two models are okay and we could then try to model with imputede data and even adding some more covariates we are interested in to the model.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
