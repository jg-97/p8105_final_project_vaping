<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Daniela Quigee (dq2147)" />


<title>Logistic Regression: Model Building</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Overview.html">Project Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data.html">Data</a>
</li>
<li>
  <a href="https://dani-quigee-shiny.shinyapps.io/My_first_Shiny/#section-drug-use">Explore the Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="EDA.html">EDA</a>
    </li>
    <li>
      <a href="Logistic_Regression_Description.html">Logistic Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="Screencast.html">
    <span class="fa fa-video fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/jg-97/p8105_final_project_vaping">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Logistic Regression: Model Building</h1>
<h4 class="author">Daniela Quigee (dq2147)</h4>
<h4 class="date">12/3/2019</h4>

</div>


<pre class="r"><code># Loading the cleaned data
load(&quot;./data/nyc_data.RData&quot;)</code></pre>
<pre class="r"><code># Creating the dataset we will use to build the model
df = df_total %&gt;% 
  ### Select only possible candidates from the data set 
  select(
    year,
    # binary respone
    current_vaping,
    # possible predictor
    borough,
    age,
    sex,
    race7,
    sad_hopeless,
    attempted_suicide,
    injurious_suicide_attempt,
    considered_suicide,
    safety_concerns_at_school,
    threatened_at_school,
    physical_fighting,
    bullying_at_school,
    bullying_electronically,
    illegal_injected_drug_use,
    carring_weapon,
    sex_before_13,
    current_sexual_activity) %&gt;%
    #### Basing model on data from 2015
  filter(year == 2015) %&gt;% 
    ### we do our anaylsis on complete datasets
  drop_na()</code></pre>
<div id="method-1-manual-selection" class="section level1">
<h1>Method 1: Manual Selection</h1>
<pre class="r"><code># Fitting a logistic regression model
fit_logistic = glm(current_vaping ~ sad_hopeless  + attempted_suicide + safety_concerns_at_school + illegal_injected_drug_use + physical_fighting + bullying_electronically + carring_weapon + sex_before_13 , data = df, family = binomial(),na.action = na.omit)

# Looking at the model coefficients
fit_logistic %&gt;% 
  broom::tidy() %&gt;% 
  mutate(OR = exp(estimate)) %&gt;%
  knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">OR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-2.430</td>
<td align="right">0.503</td>
<td align="right">-4.834</td>
<td align="right">0.000</td>
<td align="right">0.088</td>
</tr>
<tr class="even">
<td align="left">sad_hopelessNo</td>
<td align="right">0.516</td>
<td align="right">0.089</td>
<td align="right">5.822</td>
<td align="right">0.000</td>
<td align="right">1.674</td>
</tr>
<tr class="odd">
<td align="left">attempted_suicideNo</td>
<td align="right">0.663</td>
<td align="right">0.140</td>
<td align="right">4.734</td>
<td align="right">0.000</td>
<td align="right">1.941</td>
</tr>
<tr class="even">
<td align="left">safety_concerns_at_schoolNo</td>
<td align="right">0.281</td>
<td align="right">0.181</td>
<td align="right">1.556</td>
<td align="right">0.120</td>
<td align="right">1.325</td>
</tr>
<tr class="odd">
<td align="left">illegal_injected_drug_useNo</td>
<td align="right">1.195</td>
<td align="right">0.465</td>
<td align="right">2.573</td>
<td align="right">0.010</td>
<td align="right">3.305</td>
</tr>
<tr class="even">
<td align="left">physical_fightingNo</td>
<td align="right">0.774</td>
<td align="right">0.095</td>
<td align="right">8.138</td>
<td align="right">0.000</td>
<td align="right">2.168</td>
</tr>
<tr class="odd">
<td align="left">bullying_electronicallyNo</td>
<td align="right">0.122</td>
<td align="right">0.123</td>
<td align="right">0.993</td>
<td align="right">0.321</td>
<td align="right">1.130</td>
</tr>
<tr class="even">
<td align="left">carring_weaponNo</td>
<td align="right">0.688</td>
<td align="right">0.141</td>
<td align="right">4.894</td>
<td align="right">0.000</td>
<td align="right">1.989</td>
</tr>
<tr class="odd">
<td align="left">sex_before_13No/No sex yet</td>
<td align="right">0.471</td>
<td align="right">0.185</td>
<td align="right">2.537</td>
<td align="right">0.011</td>
<td align="right">1.601</td>
</tr>
</tbody>
</table>
<pre class="r"><code># What is the contribution of each predictor? see: https://uc-r.github.io/logistic_regression#multi
caret::varImp(fit_logistic)</code></pre>
<pre><code>##                               Overall
## sad_hopelessNo              5.8223727
## attempted_suicideNo         4.7336537
## safety_concerns_at_schoolNo 1.5556539
## illegal_injected_drug_useNo 2.5732327
## physical_fightingNo         8.1380930
## bullying_electronicallyNo   0.9926268
## carring_weaponNo            4.8939961
## sex_before_13No/No sex yet  2.5374951</code></pre>
<pre class="r"><code># Cross-Validating the model
data_train &lt;- trainControl(method = &quot;cv&quot;, number = 5)

model_caret &lt;- train(
  current_vaping ~ sad_hopeless  + attempted_suicide + safety_concerns_at_school + threatened_at_school + physical_fighting + bullying_electronically + carring_weapon,
                   data = df,
                   trControl = data_train,
                   method = &#39;glm&#39;,
                   family = binomial(),
                   na.action = na.pass)
  
model_caret</code></pre>
<pre><code>## Generalized Linear Model 
## 
## 4992 samples
##    7 predictor
##    2 classes: &#39;Yes&#39;, &#39;No&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold) 
## Summary of sample sizes: 3994, 3994, 3993, 3994, 3993 
## Resampling results:
## 
##   Accuracy   Kappa     
##   0.8509616  0.04401816</code></pre>
<pre class="r"><code>AIC(fit_logistic)</code></pre>
<pre><code>## [1] 3957.311</code></pre>
<pre class="r"><code>fit_logistic$formula</code></pre>
<pre><code>## current_vaping ~ sad_hopeless + attempted_suicide + safety_concerns_at_school + 
##     illegal_injected_drug_use + physical_fighting + bullying_electronically + 
##     carring_weapon + sex_before_13</code></pre>
<p>Model 1: current_vaping ~ sad_hopeless + attempted_suicide + safety_concerns_at_school + illegal_injected_drug_use + physical_fighting + bullying_electronically + carring_weapon + sex_before_13</p>
</div>
<div id="method-2-step-aic-regression-generatoion" class="section level1">
<h1>Method 2: Step AIC regression generatoion</h1>
<pre class="r"><code>###Defining a glm object that contains the regression model generated
auto_logistic = glm(
  ###Fixing &quot;current_vaping&quot; as response,whith all the vairble candidtates as pridictors.
  current_vaping ~., data = df, 
  ###Runing logistics regression, with complete analysis
  family = binomial(),na.action = na.omit) %&gt;%
  ###Choose a model by AIC in a Stepwise Algorithm
  MASS::stepAIC(trace = FALSE)

AIC(auto_logistic)</code></pre>
<pre><code>## [1] 3795.667</code></pre>
<pre class="r"><code>auto_logistic %&gt;% broom::tidy()</code></pre>
<pre><code>## # A tibble: 16 x 5
##    term                               estimate std.error statistic  p.value
##    &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)                          -2.94     0.605     -4.87  1.13e- 6
##  2 sexmale                               0.338    0.0910     3.71  2.04e- 4
##  3 race7Asian                            0.779    0.336      2.32  2.03e- 2
##  4 race7Black or African American        0.976    0.323      3.02  2.53e- 3
##  5 race7Hispanic/Latino                  0.192    0.311      0.619 5.36e- 1
##  6 race7Multiple Races (Non-Hispanic)    0.502    0.379      1.32  1.86e- 1
##  7 race7Native Hawaiian/Other Pacifi…    0.179    0.444      0.402 6.87e- 1
##  8 race7White                           -0.211    0.319     -0.660 5.09e- 1
##  9 sad_hopelessNo                        0.428    0.0910     4.71  2.53e- 6
## 10 attempted_suicideNo                   0.589    0.144      4.09  4.36e- 5
## 11 safety_concerns_at_schoolNo           0.299    0.183      1.63  1.03e- 1
## 12 physical_fightingNo                   0.766    0.0993     7.71  1.24e-14
## 13 illegal_injected_drug_useNo           0.934    0.487      1.92  5.53e- 2
## 14 carring_weaponNo                      0.631    0.147      4.29  1.81e- 5
## 15 sex_before_13No/No sex yet            0.425    0.196      2.17  3.01e- 2
## 16 current_sexual_activitynever sex/…    0.816    0.0943     8.65  5.00e-18</code></pre>
<pre class="r"><code>auto_logistic$formula</code></pre>
<pre><code>## current_vaping ~ sex + race7 + sad_hopeless + attempted_suicide + 
##     safety_concerns_at_school + physical_fighting + illegal_injected_drug_use + 
##     carring_weapon + sex_before_13 + current_sexual_activity</code></pre>
<p>Model 2: current_vaping ~ sex + race7 + sad_hopeless + attempted_suicide + safety_concerns_at_school + physical_fighting + illegal_injected_drug_use + carring_weapon + sex_before_13 + current_sexual_activity</p>
</div>
<div id="method-3lasso-regression-generation" class="section level1">
<h1>Method 3:Lasso regression generation</h1>
<pre class="r"><code>###Defining a glmnet object that contains the cv lasso model generated to find the best lambda to use
  lasso_temp = cv.glmnet(
  ###Fixing &quot;current_vaping&quot; as response,whith all the vairble candidtates as pridictors.
    current_vaping ~., data = df, 
    ###Runing for logistics outcom
    family = &quot;binomial&quot;)

###Defining a glmnet object that contains the final lasso model using the best lambda generated
  lasso_logistic = glmnet(
  ###Fixing &quot;current_vaping&quot; as response,whith all the vairble candidtates as pridictors.
    current_vaping ~., data = df, 
    ###Runing for logistics outcom
    family = &quot;binomial&quot;,
    ### With the best lambda
    lambda = lasso_temp$lambda.min
    )


#See the accuracy of prediction with this model
lasso_logistic %&gt;% broom::tidy()</code></pre>
<pre><code>## # A tibble: 28 x 5
##    term                                step estimate  lambda dev.ratio
##    &lt;chr&gt;                              &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)                            1  2.36    0.00500     0.104
##  2 age14 years old                        1  0.0435  0.00500     0.104
##  3 age16 years old                        1 -0.00273 0.00500     0.104
##  4 sexfemale                              1 -0.221   0.00500     0.104
##  5 race7Asian                             1  0.399   0.00500     0.104
##  6 race7Black or African American         1  0.601   0.00500     0.104
##  7 race7Hispanic/Latino                   1 -0.0129  0.00500     0.104
##  8 race7Multiple Races (Non-Hispanic)     1  0.0295  0.00500     0.104
##  9 race7White                             1 -0.342   0.00500     0.104
## 10 sad_hopelessYes                        1 -0.386   0.00500     0.104
## # … with 18 more rows</code></pre>
<p>Model 3: current_vaping ~ age + sex + race7 + sad_hopeless + attempted_suicide + injurious_suicide_attempt + safety_concerns_at_school + physical_fighting + bullying_electronically + illegal_injected_drug_use + carring_weapon + sex_before_13 + current_sexual_activity</p>
<p>The LASSO model has tunning paramter lamda equals 0.005 and the model contains more covariates than the above two models since LASSO putting shringkage on the coefficient of each covariate and thus will include more covariates (remember that LASSO will automatically do the variable selection).</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
