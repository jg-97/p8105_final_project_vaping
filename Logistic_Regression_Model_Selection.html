<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Daniela Quigee (dq2147)" />


<title>Logistic Regression: Model Selection</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Overview.html">Project Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data.html">Data</a>
</li>
<li>
  <a href="https://dani-quigee-shiny.shinyapps.io/My_first_Shiny/#section-drug-use">Explore the Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="EDA.html">EDA</a>
    </li>
    <li>
      <a href="Logistic_Regression_Description.html">Logistic Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="Report.html">Report</a>
</li>
<li>
  <a href="Screencast.html">
    <span class="fa fa-video fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/jg-97/p8105_final_project_vaping">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Logistic Regression: Model Selection</h1>
<h4 class="author">Daniela Quigee (dq2147)</h4>
<h4 class="date">12/3/2019</h4>

</div>


<p>To select for the best model that can predict whether the kid vaped or not based on self reported status that they are willing to share, we rewrite our model selection method as function that can be mapped top a modelr cv object by purrr to streamline the crossvalidation proscess.</p>
<div id="model-standarization-priming-for-selection" class="section level1">
<h1>Model standarization priming for selection</h1>
<pre class="r"><code>## function for stepAIC method
log_reg_auto = function(cv_df){
  cv_df %&gt;%mutate(
###Automodel selection with AIC as criterial
         automodel  = map(train, ~glm(current_vaping ~., data = .x, family = binomial(),na.action = na.exclude)%&gt;%MASS::stepAIC(trace = FALSE))
 ) }

###function for lasso selection method
lasso = function(df){
  lasso_temp = cv.glmnet(current_vaping ~., data = df, family = &quot;binomial&quot;)
glmnet(current_vaping ~., data = df, family = &quot;binomial&quot;,lambda = lasso_temp$lambda.min)
}
### formular for manual selection
manual_formular = current_vaping ~ sad_hopeless + attempted_suicide + safety_concerns_at_school + 
    threatened_at_school + physical_fighting + bullying_electronically + 
    carring_weapon

###find prediction accuracy
accy = function(model,data){
  Temp = predict(model, data, type = &quot;response&quot;)%&gt;%round()
1-mean(Temp-(as.numeric(pull(as.tibble(data),current_vaping))-1))
}</code></pre>
</div>
<div id="cross_validation-dataset-preparation" class="section level1">
<h1>cross_validation dataset preparation:</h1>
<pre class="r"><code>cv_df =
  ## Making the CV_df by modelr, for 5 folds and 10 times.
  crossv_mc(df15,n=10)</code></pre>
</div>
<div id="model-validationselection" class="section level1">
<h1>Model validation/Selection</h1>
<p>The cv_df will be feeds to all three models and then the accuracy of prediction of each on the test dataset will compute and graphically displayed.</p>
<pre class="r"><code>cv_df = cv_df %&gt;%
##stepAIC
  log_reg_auto() %&gt;%
  ## Manual model
  mutate(manual_model = map(train, ~glm(manual_formular, data = .x, family = binomial,na.action = na.exclude)))%&gt;%
  ## Lasso model
 mutate(lasso_model = map(train,~lasso(.x)))</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre class="r"><code>###Prediction Accuracy computation
cv_df = cv_df %&gt;%
  mutate(
        accuracy_automodel= map2_dbl(.x = automodel,.y = test, ~accy(data =.y,model =.x)),
        accuracy_manualmodel= map2_dbl(.x = manual_model,.y = test, ~accy(data =.y,model =.x)),
        accuracy_lasso= map2_dbl(.x = lasso_model,.y = test, ~accy(data =.y,model =.x))
        )</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre><code>## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame

## Warning in (function (formula, data, weights = NULL, offset = NULL, subset
## = NULL, : input data was converted to data.frame</code></pre>
<pre class="r"><code>###Graph accuracy distribution
cv_df %&gt;% select(starts_with(&quot;accuracy&quot;)) %&gt;% 
  pivot_longer(
    everything(),
    names_to = &quot;model&quot;, 
    values_to = &quot;Accuracy&quot;,
    names_prefix = &quot;accuracy_&quot;) %&gt;% 
  mutate(Models = recode(model,automodel = &quot;StepAIC Model&quot;,manualmodel = &quot;Manual Model&quot;, lasso = &quot;Lasso Model&quot;)) %&gt;%
  ggplot(aes(x = Models, y = Accuracy)) + geom_violin()</code></pre>
<p><img src="Logistic_Regression_Model_Selection_files/figure-html/CrossValidation-1.png" width="672" /></p>
<div id="final-model-selection" class="section level2">
<h2>Final model selection</h2>
<pre class="r"><code>## The model generated using the full data set is recreated
Final_model =
  ## tibble
  tibble(train = list(df15),
         test = list(df17)) %&gt;%
  ##stepAIC
  log_reg_auto() %&gt;%
  ## Manual model
  mutate(manualmodel = map(train, ~glm(manual_formular, data = .x, family = binomial,na.action = na.exclude))) %&gt;%
  ## Lasso model
  mutate(lassomodel = map(train,~lasso(.x)))</code></pre>
<p>It occurs that the accuracy of the models generated by stepAIC are the best among the three models, also with a slightly better consistancy.In terms of number of predictors, the stepAIC model have 10 less predictors than the lasso one.Therefore the stepAIC model will be the model of our choosing.</p>
</div>
<div id="performance-in-predicting-2017-behavior-of-all-three-models." class="section level2">
<h2>Performance in predicting 2017 behavior of all three models.</h2>
<pre class="r"><code>Final_model %&gt;%
  mutate(
        accuracy_automodel= map2_dbl(.x = automodel,.y = test, ~accy(data =.y,model =.x)),
        accuracy_manualmodel= map2_dbl(.x = manualmodel,.y = test, ~accy(data =.y,model =.x)),
        accuracy_lasso= map2_dbl(.x = lassomodel,.y = test, ~accy(data =.y,model =.x))
        ) %&gt;%
  select(&quot;Accuracy StepAIC Model&quot;=accuracy_automodel, &quot;Accuracy Manual Model&quot; = accuracy_manualmodel, &quot;Accuracy Lasso Model&quot;= accuracy_lasso)%&gt;%round(digits = 3) %&gt;% knitr::kable(caption = &quot;Prediction Accuray by Model on 2017 data&quot;)</code></pre>
<table>
<caption>Prediction Accuray by Model on 2017 data</caption>
<thead>
<tr class="header">
<th align="right">Accuracy StepAIC Model</th>
<th align="right">Accuracy Manual Model</th>
<th align="right">Accuracy Lasso Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.873</td>
<td align="right">0.863</td>
<td align="right">0.866</td>
</tr>
</tbody>
</table>
<p>Consequntaily, the model of our choosing also turns out to give the most accurate prediction of the the vaping status for kids in 2017. The parameters of each predictos and the P value associated with it are shown as follow:</p>
<pre class="r"><code>Final_model[[1,3]] %&gt;% broom::tidy() %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-2.9432403</td>
<td align="right">0.6046158</td>
<td align="right">-4.8679514</td>
<td align="right">0.0000011</td>
</tr>
<tr class="even">
<td align="left">sexmale</td>
<td align="right">0.3377825</td>
<td align="right">0.0909584</td>
<td align="right">3.7135930</td>
<td align="right">0.0002043</td>
</tr>
<tr class="odd">
<td align="left">race7Asian</td>
<td align="right">0.7788399</td>
<td align="right">0.3356866</td>
<td align="right">2.3201403</td>
<td align="right">0.0203333</td>
</tr>
<tr class="even">
<td align="left">race7Black or African American</td>
<td align="right">0.9757567</td>
<td align="right">0.3231658</td>
<td align="right">3.0193685</td>
<td align="right">0.0025330</td>
</tr>
<tr class="odd">
<td align="left">race7Hispanic/Latino</td>
<td align="right">0.1922447</td>
<td align="right">0.3106394</td>
<td align="right">0.6188676</td>
<td align="right">0.5360036</td>
</tr>
<tr class="even">
<td align="left">race7Multiple Races (Non-Hispanic)</td>
<td align="right">0.5017120</td>
<td align="right">0.3793141</td>
<td align="right">1.3226821</td>
<td align="right">0.1859411</td>
</tr>
<tr class="odd">
<td align="left">race7Native Hawaiian/Other Pacific Islander</td>
<td align="right">0.1785621</td>
<td align="right">0.4438397</td>
<td align="right">0.4023123</td>
<td align="right">0.6874542</td>
</tr>
<tr class="even">
<td align="left">race7White</td>
<td align="right">-0.2106758</td>
<td align="right">0.3191358</td>
<td align="right">-0.6601447</td>
<td align="right">0.5091610</td>
</tr>
<tr class="odd">
<td align="left">sad_hopelessNo</td>
<td align="right">0.4283129</td>
<td align="right">0.0910190</td>
<td align="right">4.7057542</td>
<td align="right">0.0000025</td>
</tr>
<tr class="even">
<td align="left">attempted_suicideNo</td>
<td align="right">0.5886823</td>
<td align="right">0.1440285</td>
<td align="right">4.0872612</td>
<td align="right">0.0000436</td>
</tr>
<tr class="odd">
<td align="left">safety_concerns_at_schoolNo</td>
<td align="right">0.2988078</td>
<td align="right">0.1830683</td>
<td align="right">1.6322209</td>
<td align="right">0.1026330</td>
</tr>
<tr class="even">
<td align="left">physical_fightingNo</td>
<td align="right">0.7660082</td>
<td align="right">0.0993296</td>
<td align="right">7.7117850</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">illegal_injected_drug_useNo</td>
<td align="right">0.9335128</td>
<td align="right">0.4870586</td>
<td align="right">1.9166333</td>
<td align="right">0.0552845</td>
</tr>
<tr class="even">
<td align="left">carring_weaponNo</td>
<td align="right">0.6312043</td>
<td align="right">0.1472242</td>
<td align="right">4.2873684</td>
<td align="right">0.0000181</td>
</tr>
<tr class="odd">
<td align="left">sex_before_13No/No sex yet</td>
<td align="right">0.4253948</td>
<td align="right">0.1961925</td>
<td align="right">2.1682522</td>
<td align="right">0.0301395</td>
</tr>
<tr class="even">
<td align="left">current_sexual_activitynever sex/no sex during past 3 month</td>
<td align="right">0.8159507</td>
<td align="right">0.0942926</td>
<td align="right">8.6533953</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>Final_model[[1,3]]$formula</code></pre>
<pre><code>## current_vaping ~ sex + race7 + sad_hopeless + attempted_suicide + 
##     safety_concerns_at_school + physical_fighting + illegal_injected_drug_use + 
##     carring_weapon + sex_before_13 + current_sexual_activity
## &lt;environment: 0x7fc4f57bbef8&gt;</code></pre>
<pre class="r"><code>Final_model</code></pre>
<pre><code>## # A tibble: 1 x 5
##   train                test                automodel manualmodel lassomodel
##   &lt;list&gt;               &lt;list&gt;              &lt;list&gt;    &lt;list&gt;      &lt;list&gt;    
## 1 &lt;tibble [4,992 × 19… &lt;tibble [5,541 × 1… &lt;glm&gt;     &lt;glm&gt;       &lt;glmnt.fr&gt;</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
