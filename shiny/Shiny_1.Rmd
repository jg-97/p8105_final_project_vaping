---
title: "NYC Youth"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    css: styles_Dashboard.css
runtime: shiny
---

```{r setup, include=FALSE}
# Loading necessary libraries
library(flexdashboard)
library(shiny)
library(plotly)
library(tidyverse)

# Loading the cleaned data
load("./data/nyc_data.RData")
```


Drug Use by Demographics
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
```{r Sidebar_11}
drugs_1 = c("Marijuana", "Alcohol", "Cigarettes", "Vaping", "Cigar")
  
selectInput("drugs_1", label = h3("Choose Substance Abuse"),
            choices = as.list(drugs_1), selected = "Marijuana")



years_D = df_total %>% distinct(year) %>% pull()
  
selectInput("years_D", label = h3("Choose year"),
            choices = as.list(years_D), selected = "2017")


boroughs_D = df_total %>% distinct(borough) %>% pull()

selectInput("boroughs_D",label = h3("Select borough"),
            choices = boroughs_D, selected = "Manhattan")

radioButtons(
  "grouping_choice_D", 
  label = h3("Group by"),
  choices = c("nothing", "sex", "age", "race"))
```


Column {.tabset .tabset-fade .tabset-pills}
-----------------------------------------------------------------------

### <span style="color:#69899f"> **Drug Use** </span>

```{r data_11}
renderPlotly({
  df_11 = df_total %>% 
    filter(
      borough == input$boroughs_D &
      year == input$years_D) 
  
  if (input$grouping_choice_D == "nothing")
  {
    if (input$drugs_1 == "Marijuana") {
      df_11 = df_11 %>%
        filter(!(is.na(current_marijuana_use))) %>% 
        count(current_marijuana_use) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_1 == "Alcohol") {
      df_11 = df_11 %>%
        filter(!(is.na(current_alcohol_use))) %>% 
        count(current_alcohol_use) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_1 == "Cigarettes") {
      df_11 = df_11 %>%
        filter(!(is.na(current_cigarette_use))) %>% 
        count(current_cigarette_use) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_1 == "Vaping") {
      df_11 = df_11 %>%
        filter(!(is.na(current_vaping))) %>% 
        count(current_vaping) %>% 
        rename(x = current_vaping)}
    else if (input$drugs_1 == "Cigar") {
      df_11 = df_11 %>%
        filter(!(is.na(current_cigar_use))) %>% 
        count(current_cigar_use) %>% 
        rename(x = current_cigar_use)}
    
    df_11 = df_11 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
    
    if (nrow(df_11) > 1)
    {
      df_11 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          marker = list(
            color = 'rgb(158,202,225)',
            line = list(color = 'rgb(8,48,107)',width = 1.5)),
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = str_c(input$drugs_1)),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage currently use ", input$drugs_1," (past 30 days)\n ",input$boroughs_D, " ", input$years_D))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  else if (input$grouping_choice_D == "sex")
  {
    if (input$drugs_1 == "Marijuana") {
      df_11 = df_11 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(current_marijuana_use) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_1 == "Alcohol") {
      df_11 = df_11 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(current_alcohol_use) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_1 == "Cigarettes") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(current_cigarette_use) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_1 == "Vaping") {
      df_11 = df_11 %>%
        filter((!(is.na(current_vaping))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(current_vaping) %>% 
        rename(x = current_vaping)}
    else if (input$drugs_1 == "Cigar") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(current_cigar_use) %>% 
        rename(x = current_cigar_use)}
    
    df_11 = df_11 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
    
    if (nrow(df_11) > 1)
    {
      df_11 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          color = ~sex,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = str_c(input$drugs_1)),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage currently use ", input$drugs_1," (past 30 days)\n ",input$boroughs_D, " ", input$years_D))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  else if (input$grouping_choice_D == "age")
  {
    if (input$drugs_1 == "Marijuana") {
      df_11 = df_11 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(current_marijuana_use) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_1 == "Alcohol") {
      df_11 = df_11 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(current_alcohol_use) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_1 == "Cigarettes") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(current_cigarette_use) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_1 == "Vaping") {
      df_11 = df_11 %>%
        filter((!(is.na(current_vaping))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(current_vaping) %>% 
        rename(x = current_vaping)}
    else if (input$drugs_1 == "Cigar") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(current_cigar_use) %>% 
        rename(x = current_cigar_use)}
    
    df_11 = df_11 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
    
    if (nrow(df_11) > 1)
    {
      df_11 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          color = ~age,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = str_c(input$drugs_1)),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage currently use ", input$drugs_1," (past 30 days)\n",input$boroughs_D, " ", input$years_D))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  else if (input$grouping_choice_D == "race")
  {
    if (input$drugs_1 == "Marijuana") {
      df_11 = df_11 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(current_marijuana_use) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_1 == "Alcohol") {
      df_11 = df_11 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(current_alcohol_use) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_1 == "Cigarettes") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(current_cigarette_use) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_1 == "Vaping") {
      df_11 = df_11 %>%
        filter((!(is.na(current_vaping))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(current_vaping) %>% 
        rename(x = current_vaping)}
    else if (input$drugs_1 == "Cigar") {
      df_11 = df_11 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(current_cigar_use) %>% 
        rename(x = current_cigar_use)}
    
    df_11 = df_11 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
    
    if (nrow(df_11) > 1)
    {
      df_11 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent,
          color = ~race7,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = str_c(input$drugs_1)),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage currently use ", input$drugs_1," (past 30 days)\n",input$boroughs_D, " ", input$years_D))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
})
```

### <span style="color:#69899f"> **Description** </span>

<br> <br>

* **Marijuana**:   respondent used marijuana during the past 30 days   (Yes/No)
* **Alcohol**:   respondent had at least one drink of alcohol during the past 30 days   (Yes/No)
* **Cigarettes**:   respondent smoked cigarettes during the past 30 days   (Yes/No)
* **Vaping**:   respondent used an electronic vapor product during the past 30 days   (Yes/No)
* **Cigar**:   respondent smoked cigars, cigarillos, or little cigars during the past 30 days   (Yes/No)


Drug Use over Time
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
```{r Sidebar_12}
drugs_2 = c("Marijuana", "Alcohol", "Cigarettes", "Vaping", "Cigar", "All")
  
selectInput("drugs_2", label = h3("Choose Substance Abuse"),
            choices = as.list(drugs_2), selected = "Marijuana")
```

Column {.tabset}
-----------------------------------------------------------------------

### <span style="color:#69899f"> **Drug Use** </span>

```{r data_12}
renderPlotly({
  
  if (input$drugs_2 == "Marijuana") {
    df_12 = df_total %>% 
      filter(!(is.na(current_marijuana_use))) %>%
      group_by(year, borough) %>% 
      count(current_marijuana_use) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(current_marijuana_use == "Yes")
  }
  else if (input$drugs_2 == "Alcohol") {
    df_12 = df_total %>% 
      filter(!(is.na(current_alcohol_use))) %>% 
      group_by(year, borough) %>% 
      count(current_alcohol_use) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(current_alcohol_use == "Yes")
  }
  else if (input$drugs_2 == "Cigarettes") {
    df_12 = df_total %>% 
      filter(!(is.na(current_cigarette_use))) %>% 
      group_by(year, borough) %>% 
      count(current_cigarette_use) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(current_cigarette_use == "Yes")
  }
  else if (input$drugs_2 == "Vaping") {
    df_12 = df_total %>% 
      filter(!(is.na(current_vaping))) %>% 
      group_by(year, borough) %>% 
      count(current_vaping) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(current_vaping == "Yes")
  }
  else if (input$drugs_2 == "Cigar") {
    df_12 = df_total %>% 
      filter(!(is.na(current_cigar_use))) %>% 
      group_by(year, borough) %>% 
      count(current_cigar_use) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(current_cigar_use == "Yes")
  }
  else if (input$drugs_2 == "All") {
    df_12 = df_total %>% 
      select(
        year, 
        borough, 
        current_marijuana_use, 
        current_alcohol_use,
        current_cigarette_use,
        current_vaping,
        current_cigar_use) %>% 
      pivot_longer(
        current_marijuana_use:current_cigar_use,
        names_to = "drugs",
        names_prefix = "current_",
        values_to = "values"
      ) %>% 
      drop_na(values) %>% 
      mutate(
      drugs = str_replace(drugs, "_use", "")) %>% 
      group_by(drugs, year, borough, values) %>% 
      count(drugs) %>% 
      ungroup() %>% 
      group_by(drugs, year, borough) %>% 
      mutate(
        summe = sum(n)) %>% 
      mutate(
        percent = (n / summe),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(values == "Yes") %>% 
      select(-n, -summe, -values)
  }

  if (input$drugs_2 != "All") {
  df_12 %>% 
      plot_ly(
        x = ~year,
        y = ~percent,
        color = ~borough,
        alpha = 0.7,
        line = list( width = 3, dash = 'dash'),
        text = ~str_c(borough, "\n", input$drugs_2),
        hovertemplate = paste("<b>%{text}</b>\nYear: %{x}\n%{y} % ","<extra></extra>")) %>% 
      layout( 
          xaxis = list(
            title = "Year",
            dtick = 2,
            tick0 = 2003,
            tickmode = "linear",
            range = c(2001, 2019)),
          yaxis = list(
            title = "Percent",
            dtick = 5,
            tick0 = 0,
            tickmode = "linear",
            range = c(0, 50)),
          title = str_c("Percentage currently use ", input$drugs_2, " (past 30 days) over time"))
  }
  else {
    df_12 %>% 
      plot_ly(
        x = ~year,
        y = ~percent,
        color = ~borough,
        alpha = 0.6,
        linetype = ~drugs,
        text = ~str_c(borough, "\n", drugs),
        hovertemplate = paste("<b>%{text}</b>\nYear: %{x}\n%{y} % ","<extra></extra>")) %>% 
      layout( 
          xaxis = list(
            title = "Year",
            dtick = 2,
            tick0 = 2003,
            tickmode = "linear",
            range = c(2001, 2019)),
          yaxis = list(
            title = "Percent",
            dtick = 5,
            tick0 = 0,
            tickmode = "linear",
            range = c(0, 50)),
          title = str_c("Percentage currently use ", input$drugs_2, " (past 30 days) over time"))
  }
})
```

### <span style="color:#69899f"> **Description** </span>

<br> <br>

* **Marijuana**:   respondent used marijuana during the past 30 days   (Yes/No)
* **Alcohol**:   respondent had at least one drink of alcohol during the past 30 days   (Yes/No)
* **Cigarettes**:   respondent smoked cigarettes during the past 30 days   (Yes/No)
* **Vaping**:   respondent used an electronic vapor product during the past 30 days   (Yes/No)
* **Cigar**:   respondent smoked cigars, cigarillos, or little cigars during the past 30 days   (Yes/No)



Mental Health by Demographics
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
```{r Sidebar_21}
mental_health_1 = c("feel sad or hopeless", "considered suicide", "attempted suicide", "injured during attempted suicide")
  
selectInput("mental_health_1", label = h3("Choose Mental Health"),
            choices = as.list(mental_health_1), selected = "Felt Sad")



years_M = df_total %>% distinct(year) %>% pull()
  
selectInput("years_M", label = h3("Choose year"),
            choices = as.list(years_M), selected = "2017")


boroughs_M = df_total %>% distinct(borough) %>% pull()

selectInput("boroughs_M",label = h3("Select borough"),
            choices = boroughs_M, selected = "Manhattan")

radioButtons(
  "grouping_choice_M", 
  label = h3("Group by"),
  choices = c("nothing", "sex", "age", "race"))
```

Column {.tabset}
-----------------------------------------------------------------------

### <span style="color:#69899f"> **Mental Health** </span>

```{r data_21}
renderPlotly({
  df_21 = df_total %>% 
    filter(
      borough == input$boroughs_M &
      year == input$years_M) 
  
  if (input$grouping_choice_M == "nothing")
  {
    if (input$mental_health_1 == "feel sad or hopeless") {
      df_21 = df_21 %>%
        filter(!(is.na(sad_hopeless))) %>% 
        count(sad_hopeless) %>% 
        rename(x = sad_hopeless)}
    else if (input$mental_health_1 == "considered suicide") {
      df_21 = df_21 %>%
        filter(!(is.na(considered_suicide))) %>% 
        count(considered_suicide) %>% 
        rename(x = considered_suicide)}
    else if (input$mental_health_1 == "attempted suicide") {
      df_21 = df_21 %>%
        filter(!(is.na(attempted_suicide))) %>% 
        count(attempted_suicide) %>% 
        rename(x = attempted_suicide)}
    else if (input$mental_health_1 == "injured during attempted suicide") {
      df_21 = df_21 %>%
        filter(!(is.na(injurious_suicide_attempt))) %>% 
        count(injurious_suicide_attempt) %>% 
        rename(x = injurious_suicide_attempt)}
    
  df_21 = df_21 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
  
   if (nrow(df_21) > 1)
    {
      df_21 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          marker = list(color = 'rgb(158,202,225)',
                      line = list(color = 'rgb(8,48,107)',
                                  width = 1.5)),
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = str_c(input$mental_health_1)),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage ", input$mental_health_1," (past 12 months)\n ",input$boroughs_M, " ", input$years_M))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }

  
  else if (input$grouping_choice_M == "sex")
  {
    if (input$mental_health_1 == "feel sad or hopeless") {
      df_21 = df_21 %>%
        filter((!(is.na(sad_hopeless))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(sad_hopeless) %>% 
        rename(x = sad_hopeless)}
    else if (input$mental_health_1 == "considered suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(considered_suicide))) & (!(is.na(sex)))) %>%
        group_by(sex) %>% 
        count(considered_suicide) %>% 
        rename(x = considered_suicide)}
    else if (input$mental_health_1 == "attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(attempted_suicide))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(attempted_suicide) %>% 
        rename(x = attempted_suicide)}
    else if (input$mental_health_1 == "injured during attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(injurious_suicide_attempt))) & (!(is.na(sex)))) %>% 
        group_by(sex) %>% 
        count(injurious_suicide_attempt) %>% 
        rename(x = injurious_suicide_attempt)}
    
  df_21 = df_21 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
  
   if (nrow(df_21) > 1)
    {
      df_21 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          color = ~sex,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = ""),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage ", input$mental_health_1," (past 12 months)\n ",input$boroughs_M, " ", input$years_M))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  
  
  else if (input$grouping_choice_M == "age")
  {
    if (input$mental_health_1 == "feel sad or hopeless") {
      df_21 = df_21 %>%
        filter((!(is.na(sad_hopeless))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(sad_hopeless) %>% 
        rename(x = sad_hopeless)}
    else if (input$mental_health_1 == "considered suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(considered_suicide)))  & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(considered_suicide) %>% 
        rename(x = considered_suicide)}
    else if (input$mental_health_1 == "attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(attempted_suicide))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(attempted_suicide) %>% 
        rename(x = attempted_suicide)}
    else if (input$mental_health_1 == "injured during attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(injurious_suicide_attempt))) & (!(is.na(age)))) %>% 
        group_by(age) %>% 
        count(injurious_suicide_attempt) %>% 
        rename(x = injurious_suicide_attempt)}
    
  df_21 = df_21 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
  
   if (nrow(df_21) > 1)
    {
      df_21 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          color = ~age,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = ""),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage ", input$mental_health_1," (past 12 months)\n ",input$boroughs_M, " ", input$years_M))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  
  
  else if (input$grouping_choice_M == "race")
  {
    if (input$mental_health_1 == "feel sad or hopeless") {
      df_21 = df_21 %>%
        filter((!(is.na(sad_hopeless))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(sad_hopeless) %>% 
        rename(x = sad_hopeless)}
    else if (input$mental_health_1 == "considered suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(considered_suicide)))  & (!(is.na(race7)))) %>% 
        group_by(race7) %>%
        count(considered_suicide) %>% 
        rename(x = considered_suicide)}
    else if (input$mental_health_1 == "attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(attempted_suicide))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(attempted_suicide) %>% 
        rename(x = attempted_suicide)}
    else if (input$mental_health_1 == "injured during attempted suicide") {
      df_21 = df_21 %>%
        filter((!(is.na(injurious_suicide_attempt))) & (!(is.na(race7)))) %>% 
        group_by(race7) %>% 
        count(injurious_suicide_attempt) %>% 
        rename(x = injurious_suicide_attempt)}
    
  df_21 = df_21 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
  
   if (nrow(df_21) > 1)
    {
      df_21 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          color = ~race7,
          type = "bar",
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        xaxis = list(
          title = ""),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage ", input$mental_health_1," (past 12 months)\n ",input$boroughs_M, " ", input$years_M))
    }
    else{
      text_warning = "No data available"
      x = 1
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = "")
        )
    }
  }
  
})  
```

### <span style="color:#69899f"> **Description** </span>

<br> <br>

* **feel sad or hopeless**:   during the past 12 months, respondent felt so sad or hopeless almost every day for two weeks or more in a row that doing some usual activities was impossible   (Yes/No)
* **considered suicide**:   during the past 12 months, respondent seriously considered attempting suicide   (Yes/No)
* **attempted suicide**:   during the past 12 months, respondent actually attempt suicide   (Yes/No)
* **injured during attempted suicide**:   respondent attempted suicide, during the past 12 months, resulted in an injury, poisoning, or overdose that had to be treated by a doctor or nurse   (Yes/No)



Mental Health over Time
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
```{r Sidebar_22}
mental_health_2 = c("feel sad or hopeless", "considered suicide", "attempted suicide", "injured during attempted suicide")
  
selectInput("mental_health_2", label = h3("Choose Mental Health"),
            choices = as.list(mental_health_2), selected = "Felt Sad")
```

Column {.tabset}
-----------------------------------------------------------------------

### <span style="color:#69899f"> **Mental Health** </span>

```{r data_22}
renderPlotly({
  
  if (input$mental_health_2 == "feel sad or hopeless") {
    df_22 = df_total %>%
      filter(!(is.na(sad_hopeless))) %>% 
      group_by(year, borough) %>% 
      count(sad_hopeless) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(sad_hopeless == "Yes")
  }
  else if (input$mental_health_2 == "considered suicide") {
    df_22 = df_total %>%
      filter(!(is.na(considered_suicide))) %>% 
      group_by(year, borough) %>% 
      count(considered_suicide) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(considered_suicide == "Yes")
  }
  else if (input$mental_health_2 == "attempted suicide") {
    df_22 = df_total %>%
      filter(!(is.na(attempted_suicide))) %>% 
      group_by(year, borough) %>% 
      count(attempted_suicide) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(attempted_suicide == "Yes")
  }
  else if (input$mental_health_2 == "injured during attempted suicide") {
    df_22 = df_total %>%
      filter(!(is.na(injurious_suicide_attempt))) %>% 
      group_by(year, borough) %>% 
      count(injurious_suicide_attempt) %>% 
      mutate(
        percent = (n / sum(n)),
        percent = percent * 100,
        percent = round(percent, digits = 2)) %>% 
      filter(injurious_suicide_attempt == "Yes")
  }

  df_22 %>% 
      plot_ly(
        x = ~year,
        y = ~percent,
        color = ~borough,
        alpha = 0.7,
        line = list( width = 3, dash = 'dash'),
        text = ~str_c(borough,"\n",input$mental_health_1),
        hovertemplate = paste("<b>%{text}</b>\nYear: %{x}\n%{y} % ","<extra></extra>")) %>% 
      layout( 
          xaxis = list(
            title = "Year",
            dtick = 2,
            tick0 = 2003,
            tickmode = "linear",
            range = c(2001, 2019)),
          yaxis = list(
            title = "Percent",
            dtick = 5,
            tick0 = 0,
            tickmode = "linear",
            range = c(0, 40)),
         title = str_c("Percentage ", input$mental_health_1," (past 12 months) over time"))
})
```

### <span style="color:#69899f"> **Decription** </span>

<br> <br>

* **feel sad or hopeless**:   during the past 12 months, respondent felt so sad or hopeless almost every day for two weeks or more in a row that doing some usual activities was impossible   (Yes/No)
* **considered suicide**:   during the past 12 months, respondent seriously considered attempting suicide   (Yes/No)
* **attempted suicide**:   during the past 12 months, respondent actually attempt suicide   (Yes/No)
* **injured during attempted suicide**:   respondent attempted suicide, during the past 12 months, resulted in an injury, poisoning, or overdose that had to be treated by a doctor or nurse   (Yes/No)







Drug Use, Risky Behaviors, & Violence
===================================== 

Column {.sidebar}
-----------------------------------------------------------------------
```{r Sidebar_13}
drugs_3 = c("Marijuana", "Alcohol", "Cigarettes", "Vaping", "Cigar")
  
selectInput("drugs_3", label = h3("Choose Substance Abuse"),
            choices = as.list(drugs_3), selected = "Marijuana")



years_RV = df_total %>% distinct(year) %>% pull()
  
selectInput("years_RV", label = h3("Choose year"),
            choices = as.list(years_RV), selected = "2017")


boroughs_RV = df_total %>% distinct(borough) %>% pull()

selectInput("boroughs_RV",label = h3("Select borough"),
            choices = boroughs_RV, selected = "Manhattan")

radioButtons(
  "grouping_choice_RV", 
  label = h3("Group by"),
  choices = c("illegal injected drug use", "carring weapon", 
              "safety concerns at school", "threatened at school", "physical fighting", 
              "bullying at school", "bullying electronically", "sex before 13", "current sexual activity"))
```


Column {.tabset}
-----------------------------------------------------------------------

### <span style="color:#69899f"> **Drug Use** </span>

```{r data_13}
renderPlotly({
  df_13 = df_total %>% 
    filter(
      borough == input$boroughs_RV &
      year == input$years_RV) 
  
  
  if (input$grouping_choice_RV == "illegal injected drug use")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(illegal_injected_drug_use)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(illegal_injected_drug_use) %>% 
        rename(c = illegal_injected_drug_use) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(illegal_injected_drug_use)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(illegal_injected_drug_use) %>% 
        rename(c = illegal_injected_drug_use) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(illegal_injected_drug_use)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(illegal_injected_drug_use) %>% 
        rename(c = illegal_injected_drug_use) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(illegal_injected_drug_use)))) %>% 
        group_by(current_vaping ) %>% 
        count(illegal_injected_drug_use) %>% 
        rename(c = illegal_injected_drug_use) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(illegal_injected_drug_use)))) %>% 
        group_by(current_cigar_use) %>% 
        count(illegal_injected_drug_use) %>% 
        rename(c = illegal_injected_drug_use) %>% 
        rename(x = current_cigar_use)}
  } 
  else if (input$grouping_choice_RV == "carring weapon")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(carring_weapon)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(carring_weapon) %>% 
        rename(c = carring_weapon) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(carring_weapon)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(carring_weapon) %>% 
        rename(c = carring_weapon) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(carring_weapon)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(carring_weapon) %>% 
        rename(c = carring_weapon) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(carring_weapon)))) %>% 
        group_by(current_vaping ) %>% 
        count(carring_weapon) %>% 
        rename(c = carring_weapon) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(carring_weapon)))) %>% 
        group_by(current_cigar_use) %>% 
        count(carring_weapon) %>% 
        rename(c = carring_weapon) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "safety concerns at school")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(safety_concerns_at_school)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(safety_concerns_at_school) %>% 
        rename(c = safety_concerns_at_school) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(safety_concerns_at_school)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(safety_concerns_at_school) %>% 
        rename(c = safety_concerns_at_school) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(safety_concerns_at_school)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(safety_concerns_at_school) %>% 
        rename(c = safety_concerns_at_school) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(safety_concerns_at_school)))) %>% 
        group_by(current_vaping ) %>% 
        count(safety_concerns_at_school) %>% 
        rename(c = safety_concerns_at_school) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(safety_concerns_at_school)))) %>% 
        group_by(current_cigar_use) %>% 
        count(safety_concerns_at_school) %>% 
        rename(c = safety_concerns_at_school) %>% 
        rename(x = current_cigar_use)}
  } 
  else if (input$grouping_choice_RV == "threatened at school")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(threatened_at_school)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(threatened_at_school) %>% 
        rename(c = threatened_at_school) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(threatened_at_school)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(threatened_at_school) %>% 
        rename(c = threatened_at_school) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(threatened_at_school)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(threatened_at_school) %>% 
        rename(c = threatened_at_school) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(threatened_at_school)))) %>% 
        group_by(current_vaping ) %>% 
        count(threatened_at_school) %>% 
        rename(c = threatened_at_school) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(threatened_at_school)))) %>% 
        group_by(current_cigar_use) %>% 
        count(threatened_at_school) %>% 
        rename(c = threatened_at_school) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "physical fighting")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(physical_fighting)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(physical_fighting) %>% 
        rename(c = physical_fighting) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(physical_fighting)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(physical_fighting) %>% 
        rename(c = physical_fighting) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(physical_fighting)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(physical_fighting) %>% 
        rename(c = physical_fighting) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(physical_fighting)))) %>% 
        group_by(current_vaping ) %>% 
        count(physical_fighting) %>% 
        rename(c = physical_fighting) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(physical_fighting)))) %>% 
        group_by(current_cigar_use) %>% 
        count(physical_fighting) %>% 
        rename(c = physical_fighting) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "bullying at school")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(bullying_at_school)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(bullying_at_school) %>% 
        rename(c = bullying_at_school) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(bullying_at_school)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(bullying_at_school) %>% 
        rename(c = bullying_at_school) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(bullying_at_school)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(bullying_at_school) %>% 
        rename(c = bullying_at_school) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(bullying_at_school)))) %>% 
        group_by(current_vaping ) %>% 
        count(bullying_at_school) %>% 
        rename(c = bullying_at_school) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(bullying_at_school)))) %>% 
        group_by(current_cigar_use) %>% 
        count(bullying_at_school) %>% 
        rename(c = bullying_at_school) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "bullying electronically")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(bullying_electronically)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(bullying_electronically) %>% 
        rename(c = bullying_electronically) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(bullying_electronically)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(bullying_electronically) %>% 
        rename(c = bullying_electronically) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(bullying_electronically)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(bullying_electronically) %>% 
        rename(c = bullying_electronically) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(bullying_electronically)))) %>% 
        group_by(current_vaping ) %>% 
        count(bullying_electronically) %>% 
        rename(c = bullying_electronically) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(bullying_electronically)))) %>% 
        group_by(current_cigar_use) %>% 
        count(bullying_electronically) %>% 
        rename(c = bullying_electronically) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "sex before 13")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(sex_before_13)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(sex_before_13) %>% 
        rename(c = sex_before_13) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(sex_before_13)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(sex_before_13) %>% 
        rename(c = sex_before_13) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(sex_before_13)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(sex_before_13) %>% 
        rename(c = sex_before_13) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(sex_before_13)))) %>% 
        group_by(current_vaping ) %>% 
        count(sex_before_13) %>% 
        rename(c = sex_before_13) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(sex_before_13)))) %>% 
        group_by(current_cigar_use) %>% 
        count(sex_before_13) %>% 
        rename(c = sex_before_13) %>% 
        rename(x = current_cigar_use)}
  }
  else if (input$grouping_choice_RV == "current sexual activity")
  {
    if (input$drugs_3 == "Marijuana") {
      df_13 = df_13 %>%
        filter((!(is.na(current_marijuana_use))) & (!(is.na(current_sexual_activity)))) %>% 
        group_by(current_marijuana_use) %>% 
        count(current_sexual_activity) %>% 
        rename(c = current_sexual_activity) %>% 
        rename(x = current_marijuana_use)}
    else if (input$drugs_3 == "Alcohol") {
      df_13 = df_13 %>%
        filter((!(is.na(current_alcohol_use))) & (!(is.na(current_sexual_activity)))) %>% 
        group_by(current_alcohol_use) %>% 
        count(current_sexual_activity) %>% 
        rename(c = current_sexual_activity) %>% 
        rename(x = current_alcohol_use)}
    else if (input$drugs_3 == "Cigarettes") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigarette_use))) & (!(is.na(current_sexual_activity)))) %>% 
        group_by(current_cigarette_use) %>% 
        count(current_sexual_activity) %>% 
        rename(c = current_sexual_activity) %>% 
        rename(x = current_cigarette_use)}
    else if (input$drugs_3 == "Vaping") {
      df_13 = df_13 %>%
        filter((!(is.na(current_vaping ))) & (!(is.na(current_sexual_activity)))) %>% 
        group_by(current_vaping ) %>% 
        count(current_sexual_activity) %>% 
        rename(c = current_sexual_activity) %>% 
        rename(x = current_vaping )}
    else if (input$drugs_3 == "Cigar") {
      df_13 = df_13 %>%
        filter((!(is.na(current_cigar_use))) & (!(is.na(current_sexual_activity)))) %>% 
        group_by(current_cigar_use) %>% 
        count(current_sexual_activity) %>% 
        rename(c = current_sexual_activity) %>% 
        rename(x = current_cigar_use)}
  }
    

    df_13 = df_13 %>%
      mutate(
          percent = (n / sum(n)),
          percent = percent * 100,
          percent = round(percent, digits = 2))
    
    if (nrow(df_13) > 1)
    {
      df_13 %>% 
      plot_ly(
          x = ~x, 
          y = ~percent, 
          type = "bar",
          color = ~c,
          hovertemplate = "%{y} % <extra></extra>") %>% 
      layout(
        legend = list(names = "try"),
        xaxis = list(
          title = input$drugs_3),
        yaxis = list(
          title = "Percent",
          dtick = 5,
          tick0 = 0,
          tickmode = "linear",
          range = c(0, 100)),
        title = str_c("Percentage currently use ", input$drugs_3," (past 30 days)\n ",input$boroughs_RV, " ", input$years_RV, " \ngrouped by ", input$grouping_choice_RV))
    }
    else{
      text_warning = "No data available"
      x = 1 
      y = 1
      
      plot_ly(x = ~x, y = ~y, mode = 'text', text = ~text_warning, textposition = 'middle',
        textfont = list(size = 16)) %>% 
        layout(
          xaxis = list(
            title = ""),
          yaxis = list(
            title = ""))
    }
  
})
```

### <span style="color:#69899f"> **Decription** </span>

<br> <br>

* **Marijuana**:   respondent used marijuana during the past 30 days   (Yes/No)
* **Alcohol**:   respondent had at least one drink of alcohol during the past 30 days   (Yes/No)
* **Cigarettes**:   respondent smoked cigarettes during the past 30 days   (Yes/No)
* **Vaping**:   respondent used an electronic vapor product during the past 30 days   (Yes/No)
* **Cigar**:   respondent smoked cigars, cigarillos, or little cigars during the past 30 days   (Yes/No)




<br> <br>

* **illegal_injected_drug_use**: subject has used needle to inject any illegal drug into body during life time   (Yes/No)
* **carring weapon**:   respondent carried a weapon such as a gun, knife, or club during the past 30 days   (Yes/No)
* **safety concerns at_school**:  respondent did not went to school due to feeling unsafe at school or on way to or from school during the past 30 days   (Yes/No)
* **threatened at school**:  respondent has been threatened or injured with a weapon such as a gun, knife, or club on school property during the past 12 months   (Yes/No)
* **physical fighting**:   respondent has been in a physical fight during the past 12 months   (Yes/No)
* **bullying at school**:   respondent has been bullied on school property during the past 12 months   (Yes/No)
* **bullying electronically**:   respondent has been bullied electronically (i.e. facebook) during the past 12 months   (Yes/No)
* **sex before 13**:   respondent had first sexual intercourse before age 13   (Yes/No)
* **current sexual activity**: respondent had sexual intercourse with 1 or more people during the past 3 months   (Yes/No)




